import { a } from './chunk-2BYXGS2I.js';
import { c, j, h, p, f, o, d, b, e, n } from './chunk-2LDABZU6.js';
export { l as createWorkerMessage, k as workerRPCMethods } from './chunk-2LDABZU6.js';

new URL(import.meta.url).pathname; 
var Qt=c(j$1=>{j();h();var Gt=j$1&&j$1.__awaiter||function(i,e,t,n){function s(r){return r instanceof t?r:new t(function(o){o(r);})}return new(t||(t=Promise))(function(r,o){function l(h){try{a(n.next(h));}catch(c){o(c);}}function u(h){try{a(n.throw(h));}catch(c){o(c);}}function a(h){h.done?r(h.value):s(h.value).then(l,u);}a((n=n.apply(i,e||[])).next());})},Kt=j$1&&j$1.__generator||function(i,e){var t={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},n,s,r,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(a){return function(h){return u([a,h])}}function u(a){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,s&&(r=a[0]&2?s.return:a[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,a[1])).done)return r;switch(s=0,r&&(a=[a[0]&2,r.value]),a[0]){case 0:case 1:r=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,s=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(r=t.trys,!(r=r.length>0&&r[r.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!r||a[1]>r[0]&&a[1]<r[3])){t.label=a[1];break}if(a[0]===6&&t.label<r[1]){t.label=r[1],r=a;break}if(r&&t.label<r[2]){t.label=r[2],t.ops.push(a);break}r[2]&&t.ops.pop(),t.trys.pop();continue}a=e.call(i,t);}catch(h){a=[6,h],s=0;}finally{n=r=0;}if(a[0]&5)throw a[1];return {value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(j$1,"__esModule",{value:!0});j$1.defaultNextRequest=void 0;var zn=(p(),f(o));j$1.defaultNextRequest=function(){var i=-1;return function(){return ++i}};var $n=function(){function i(e,t){t===void 0&&(t=j$1.defaultNextRequest()),this.batch=[],this.batchStarted=!1,this.lastId=-1,this.transports=e,this.requests={},this.connectPromise=this.connect(),this.requestChannel=new zn.EventEmitter,this.nextID=t;}return i.prototype.connect=function(){var e=this;return Promise.all(this.transports.map(function(t){return Gt(e,void 0,void 0,function(){return Kt(this,function(n){switch(n.label){case 0:return t.subscribe("error",this.handleError.bind(this)),t.subscribe("notification",this.handleNotification.bind(this)),[4,t.connect()];case 1:return n.sent(),[2]}})})}))},i.prototype.getPrimaryTransport=function(){return this.transports[0]},i.prototype.request=function(e,t,n){return t===void 0&&(t=!1),Gt(this,void 0,void 0,function(){var s,r,o,l,u=this;return Kt(this,function(a){return s=this.nextID().toString(),r=t?null:s,o={request:this.makeRequest(e.method,e.params||[],r),internalID:s},this.batchStarted?(l=new Promise(function(h,c){u.batch.push({resolve:h,reject:c,request:o});}),[2,l]):[2,this.getPrimaryTransport().sendData(o,n)]})})},i.prototype.close=function(){this.requestChannel.removeAllListeners(),this.transports.forEach(function(e){e.unsubscribe(),e.close();});},i.prototype.startBatch=function(){this.batchStarted=!0;},i.prototype.stopBatch=function(){if(this.batchStarted===!1)throw new Error("cannot end that which has never started");if(this.batch.length===0){this.batchStarted=!1;return}this.getPrimaryTransport().sendData(this.batch),this.batch=[],this.batchStarted=!1;},i.prototype.makeRequest=function(e,t,n){return n?{jsonrpc:"2.0",id:n,method:e,params:t}:{jsonrpc:"2.0",method:e,params:t}},i.prototype.handleError=function(e){this.requestChannel.emit("error",e);},i.prototype.handleNotification=function(e){this.requestChannel.emit("notification",e);},i}();j$1.default=$n;});var ce=c(E=>{j();h();var Vn=E&&E.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s;}||function(n,s){for(var r in s)s.hasOwnProperty(r)&&(n[r]=s[r]);},i(e,t)};return function(e,t){i(e,t);function n(){this.constructor=e;}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n);}}();Object.defineProperty(E,"__esModule",{value:!0});E.convertJSONToRPCError=E.JSONRPCError=E.ERR_UNKNOWN=E.ERR_MISSIING_ID=E.ERR_TIMEOUT=void 0;E.ERR_TIMEOUT=7777;E.ERR_MISSIING_ID=7878;E.ERR_UNKNOWN=7979;var ut=function(i){Vn(e,i);function e(t,n,s){var r=this.constructor,o=i.call(this,t)||this;return o.message=t,o.code=n,o.data=s,Object.setPrototypeOf(o,r.prototype),o}return e}(Error);E.JSONRPCError=ut;E.convertJSONToRPCError=function(i){if(i.error){var e=i.error,t=e.message,n=e.code,s=e.data;return new ut(t,n,s)}return new ut("Unknown error",E.ERR_UNKNOWN,i)};});var Xt=c(Le=>{j();h();Object.defineProperty(Le,"__esModule",{value:!0});Le.TransportRequestManager=void 0;var Gn=(p(),f(o)),fe=ce(),Kn=function(){function i(){this.pendingRequest={},this.pendingBatchRequest={},this.transportEventChannel=new Gn.EventEmitter;}return i.prototype.addRequest=function(e,t){return this.transportEventChannel.emit("pending",e),e instanceof Array?(this.addBatchReq(e,t),Promise.resolve()):this.addReq(e.internalID,t)},i.prototype.settlePendingRequest=function(e,t){var n=this;e.forEach(function(s){var r=n.pendingRequest[s.internalID];if(delete n.pendingBatchRequest[s.internalID],r!==void 0){if(t){r.reject(t);return}r.resolve(),(s.request.id===null||s.request.id===void 0)&&delete n.pendingRequest[s.internalID];}});},i.prototype.isPendingRequest=function(e){return this.pendingRequest.hasOwnProperty(e)},i.prototype.resolveResponse=function(e,t){t===void 0&&(t=!0);var n=e;try{return n=JSON.parse(e),this.checkJSONRPC(n)===!1?void 0:n instanceof Array?this.resolveBatch(n,t):this.resolveRes(n,t)}catch{var s=new fe.JSONRPCError("Bad response format",fe.ERR_UNKNOWN,e);return t&&this.transportEventChannel.emit("error",s),s}},i.prototype.addBatchReq=function(e,t){var n=this;return e.forEach(function(s){var r=s.resolve,o=s.reject,l=s.request.internalID;n.pendingBatchRequest[l]=!0,n.pendingRequest[l]={resolve:r,reject:o};}),Promise.resolve()},i.prototype.addReq=function(e,t){var n=this;return new Promise(function(s,r){t!==null&&t&&n.setRequestTimeout(e,t,r),n.pendingRequest[e]={resolve:s,reject:r};})},i.prototype.checkJSONRPC=function(e){var t=[e];return e instanceof Array&&(t=e),t.every(function(n){return n.result!==void 0||n.error!==void 0||n.method!==void 0})},i.prototype.processResult=function(e,t){if(e.error){var n=fe.convertJSONToRPCError(e);t.reject(n);return}t.resolve(e.result);},i.prototype.resolveBatch=function(e,t){var n=this,s=e.map(function(o){return n.resolveRes(o,t)}),r=s.filter(function(o){return o});if(r.length>0)return r[0]},i.prototype.resolveRes=function(e,t){var n=e.id,s=e.error,r=this.pendingRequest[n];if(r){delete this.pendingRequest[n],this.processResult(e,r),this.transportEventChannel.emit("response",e);return}if(n===void 0&&s===void 0){this.transportEventChannel.emit("notification",e);return}var o;return s&&(o=fe.convertJSONToRPCError(e)),t&&s&&o&&this.transportEventChannel.emit("error",o),o},i.prototype.setRequestTimeout=function(e,t,n){var s=this;setTimeout(function(){delete s.pendingRequest[e],n(new fe.JSONRPCError("Request timeout request took longer than "+t+" ms to resolve",fe.ERR_TIMEOUT));},t);},i}();Le.TransportRequestManager=Kn;});var de=c(Fe=>{j();h();Object.defineProperty(Fe,"__esModule",{value:!0});Fe.Transport=void 0;var Qn=Xt(),Xn=function(){function i(){this.transportRequestManager=new Qn.TransportRequestManager,this.transportRequestManager.transportEventChannel.on("error",function(){});}return i.prototype.subscribe=function(e,t){this.transportRequestManager.transportEventChannel.addListener(e,t);},i.prototype.unsubscribe=function(e,t){if(!e)return this.transportRequestManager.transportEventChannel.removeAllListeners();e&&t&&this.transportRequestManager.transportEventChannel.removeListener(e,t);},i.prototype.parseData=function(e){return e instanceof Array?e.map(function(t){return t.request.request}):e.request},i}();Fe.Transport=Xn;});var pe=c(L=>{j();h();Object.defineProperty(L,"__esModule",{value:!0});L.getNotifications=L.getBatchRequests=L.isNotification=void 0;L.isNotification=function(i){return i.request.id===void 0||i.request.id===null};L.getBatchRequests=function(i){return i instanceof Array?i.filter(function(e){var t=e.request.request.id;return t!=null}).map(function(e){return e.request}):[]};L.getNotifications=function(i){return i instanceof Array?i.filter(function(e){return L.isNotification(e.request)}).map(function(e){return e.request}):L.isNotification(i)?[i]:[]};});var Yt=c(xe=>{j();h();var Zn=xe&&xe.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s;}||function(n,s){for(var r in s)s.hasOwnProperty(r)&&(n[r]=s[r]);},i(e,t)};return function(e,t){i(e,t);function n(){this.constructor=e;}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n);}}();Object.defineProperty(xe,"__esModule",{value:!0});var Yn=de(),er=pe(),Zt=ce(),tr=function(i){Zn(e,i);function e(t,n,s){var r=i.call(this)||this;return r.connection=t,r.reqUri=n,r.resUri=s,r}return e.prototype.connect=function(){var t=this;return this.connection.on(this.resUri,function(n){t.transportRequestManager.resolveResponse(n);}),Promise.resolve()},e.prototype.sendData=function(t,n){n===void 0&&(n=null);var s=this.transportRequestManager.addRequest(t,n),r=er.getNotifications(t),o=this.parseData(t);try{return this.connection.emit(this.reqUri,o),this.transportRequestManager.settlePendingRequest(r),s}catch(u){var l=new Zt.JSONRPCError(u.message,Zt.ERR_UNKNOWN,u);return this.transportRequestManager.settlePendingRequest(r,l),Promise.reject(l)}},e.prototype.close=function(){this.connection.removeAllListeners();},e}(Yn.Transport);xe.default=tr;});var on={};d(on,{DOMException:()=>V,Headers:()=>R,Request:()=>G,Response:()=>A,fetch:()=>dt});function nr(i){return i&&DataView.prototype.isPrototypeOf(i)}function ge(i){if(typeof i!="string"&&(i=String(i)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(i)||i==="")throw new TypeError('Invalid character in header field name: "'+i+'"');return i.toLowerCase()}function ct(i){return typeof i!="string"&&(i=String(i)),i}function ft(i){var e={next:function(){var t=i.shift();return {done:t===void 0,value:t}}};return I.iterable&&(e[Symbol.iterator]=function(){return e}),e}function R(i){this.map={},i instanceof R?i.forEach(function(e,t){this.append(t,e);},this):Array.isArray(i)?i.forEach(function(e){if(e.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+e.length);this.append(e[0],e[1]);},this):i&&Object.getOwnPropertyNames(i).forEach(function(e){this.append(e,i[e]);},this);}function ht(i){if(!i._noBody){if(i.bodyUsed)return Promise.reject(new TypeError("Already read"));i.bodyUsed=!0;}}function rn(i){return new Promise(function(e,t){i.onload=function(){e(i.result);},i.onerror=function(){t(i.error);};})}function rr(i){var e=new FileReader,t=rn(e);return e.readAsArrayBuffer(i),t}function ir(i){var e=new FileReader,t=rn(e),n=/charset=([A-Za-z0-9_-]+)/.exec(i.type),s=n?n[1]:"utf-8";return e.readAsText(i,s),t}function sr(i){for(var e=new Uint8Array(i),t=new Array(e.length),n=0;n<e.length;n++)t[n]=String.fromCharCode(e[n]);return t.join("")}function tn(i){if(i.slice)return i.slice(0);var e=new Uint8Array(i.byteLength);return e.set(new Uint8Array(i)),e.buffer}function sn(){return this.bodyUsed=!1,this._initBody=function(i){this.bodyUsed=this.bodyUsed,this._bodyInit=i,i?typeof i=="string"?this._bodyText=i:I.blob&&Blob.prototype.isPrototypeOf(i)?this._bodyBlob=i:I.formData&&FormData.prototype.isPrototypeOf(i)?this._bodyFormData=i:I.searchParams&&URLSearchParams.prototype.isPrototypeOf(i)?this._bodyText=i.toString():I.arrayBuffer&&I.blob&&nr(i)?(this._bodyArrayBuffer=tn(i.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):I.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(i)||nn(i))?this._bodyArrayBuffer=tn(i):this._bodyText=i=Object.prototype.toString.call(i):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof i=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):I.searchParams&&URLSearchParams.prototype.isPrototypeOf(i)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"));},I.blob&&(this.blob=function(){var i=ht(this);if(i)return i;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var i=ht(this);return i||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else {if(I.blob)return this.blob().then(rr);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var i=ht(this);if(i)return i;if(this._bodyBlob)return ir(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(sr(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},I.formData&&(this.formData=function(){return this.text().then(lr)}),this.json=function(){return this.text().then(JSON.parse)},this}function ar(i){var e=i.toUpperCase();return or.indexOf(e)>-1?e:i}function G(i,e){if(!(this instanceof G))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');e=e||{};var t=e.body;if(i instanceof G){if(i.bodyUsed)throw new TypeError("Already read");this.url=i.url,this.credentials=i.credentials,e.headers||(this.headers=new R(i.headers)),this.method=i.method,this.mode=i.mode,this.signal=i.signal,!t&&i._bodyInit!=null&&(t=i._bodyInit,i.bodyUsed=!0);}else this.url=String(i);if(this.credentials=e.credentials||this.credentials||"same-origin",(e.headers||!this.headers)&&(this.headers=new R(e.headers)),this.method=ar(e.method||this.method||"GET"),this.mode=e.mode||this.mode||null,this.signal=e.signal||this.signal||function(){if("AbortController"in P){var r=new AbortController;return r.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&t)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(t),(this.method==="GET"||this.method==="HEAD")&&(e.cache==="no-store"||e.cache==="no-cache")){var n=/([?&])_=[^&]*/;if(n.test(this.url))this.url=this.url.replace(n,"$1_="+new Date().getTime());else {var s=/\?/;this.url+=(s.test(this.url)?"&":"?")+"_="+new Date().getTime();}}}function lr(i){var e=new FormData;return i.trim().split("&").forEach(function(t){if(t){var n=t.split("="),s=n.shift().replace(/\+/g," "),r=n.join("=").replace(/\+/g," ");e.append(decodeURIComponent(s),decodeURIComponent(r));}}),e}function ur(i){var e=new R,t=i.replace(/\r?\n[\t ]+/g," ");return t.split("\r").map(function(n){return n.indexOf(`
`)===0?n.substr(1,n.length):n}).forEach(function(n){var s=n.split(":"),r=s.shift().trim();if(r){var o=s.join(":").trim();try{e.append(r,o);}catch(l){console.warn("Response "+l.message);}}}),e}function A(i,e){if(!(this instanceof A))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(e||(e={}),this.type="default",this.status=e.status===void 0?200:e.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=e.statusText===void 0?"":""+e.statusText,this.headers=new R(e.headers),this.url=e.url||"",this._initBody(i);}function dt(i,e){return new Promise(function(t,n){var s=new G(i,e);if(s.signal&&s.signal.aborted)return n(new V("Aborted","AbortError"));var r=new XMLHttpRequest;function o(){r.abort();}r.onload=function(){var a={status:r.status,statusText:r.statusText,headers:ur(r.getAllResponseHeaders()||"")};a.url="responseURL"in r?r.responseURL:a.headers.get("X-Request-URL");var h="response"in r?r.response:r.responseText;setTimeout(function(){t(new A(h,a));},0);},r.onerror=function(){setTimeout(function(){n(new TypeError("Network request failed"));},0);},r.ontimeout=function(){setTimeout(function(){n(new TypeError("Network request failed"));},0);},r.onabort=function(){setTimeout(function(){n(new V("Aborted","AbortError"));},0);};function l(a){try{return a===""&&P.location.href?P.location.href:a}catch{return a}}if(r.open(s.method,l(s.url),!0),s.credentials==="include"?r.withCredentials=!0:s.credentials==="omit"&&(r.withCredentials=!1),"responseType"in r&&(I.blob?r.responseType="blob":I.arrayBuffer&&(r.responseType="arraybuffer")),e&&typeof e.headers=="object"&&!(e.headers instanceof R||P.Headers&&e.headers instanceof P.Headers)){var u=[];Object.getOwnPropertyNames(e.headers).forEach(function(a){u.push(ge(a)),r.setRequestHeader(a,ct(e.headers[a]));}),s.headers.forEach(function(a,h){u.indexOf(h)===-1&&r.setRequestHeader(h,a);});}else s.headers.forEach(function(a,h){r.setRequestHeader(h,a);});s.signal&&(s.signal.addEventListener("abort",o),r.onreadystatechange=function(){r.readyState===4&&s.signal.removeEventListener("abort",o);}),r.send(typeof s._bodyInit>"u"?null:s._bodyInit);})}var P,I,en,nn,or,hr,V,an=b(()=>{j();h();P=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof globalThis<"u"&&globalThis||{},I={searchParams:"URLSearchParams"in P,iterable:"Symbol"in P&&"iterator"in Symbol,blob:"FileReader"in P&&"Blob"in P&&function(){try{return new Blob,!0}catch{return !1}}(),formData:"FormData"in P,arrayBuffer:"ArrayBuffer"in P};I.arrayBuffer&&(en=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],nn=ArrayBuffer.isView||function(i){return i&&en.indexOf(Object.prototype.toString.call(i))>-1});R.prototype.append=function(i,e){i=ge(i),e=ct(e);var t=this.map[i];this.map[i]=t?t+", "+e:e;};R.prototype.delete=function(i){delete this.map[ge(i)];};R.prototype.get=function(i){return i=ge(i),this.has(i)?this.map[i]:null};R.prototype.has=function(i){return this.map.hasOwnProperty(ge(i))};R.prototype.set=function(i,e){this.map[ge(i)]=ct(e);};R.prototype.forEach=function(i,e){for(var t in this.map)this.map.hasOwnProperty(t)&&i.call(e,this.map[t],t,this);};R.prototype.keys=function(){var i=[];return this.forEach(function(e,t){i.push(t);}),ft(i)};R.prototype.values=function(){var i=[];return this.forEach(function(e){i.push(e);}),ft(i)};R.prototype.entries=function(){var i=[];return this.forEach(function(e,t){i.push([t,e]);}),ft(i)};I.iterable&&(R.prototype[Symbol.iterator]=R.prototype.entries);or=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];G.prototype.clone=function(){return new G(this,{body:this._bodyInit})};sn.call(G.prototype);sn.call(A.prototype);A.prototype.clone=function(){return new A(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new R(this.headers),url:this.url})};A.error=function(){var i=new A(null,{status:200,statusText:""});return i.status=0,i.type="error",i};hr=[301,302,303,307,308];A.redirect=function(i,e){if(hr.indexOf(e)===-1)throw new RangeError("Invalid status code");return new A(null,{status:e,headers:{location:i}})};V=P.DOMException;try{new V;}catch{V=function(e,t){this.message=e,this.name=t;var n=Error(e);this.stack=n.stack;},V.prototype=Object.create(Error.prototype),V.prototype.constructor=V;}dt.polyfill=!0;P.fetch||(P.fetch=dt,P.Headers=R,P.Request=G,P.Response=A);});var un=c((Fi,ln)=>{j();h();an();ln.exports=self.fetch.bind(self);});var fn=c(_=>{j();h();var cr=_&&_.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s;}||function(n,s){for(var r in s)s.hasOwnProperty(r)&&(n[r]=s[r]);},i(e,t)};return function(e,t){i(e,t);function n(){this.constructor=e;}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n);}}(),fr=_&&_.__awaiter||function(i,e,t,n){function s(r){return r instanceof t?r:new t(function(o){o(r);})}return new(t||(t=Promise))(function(r,o){function l(h){try{a(n.next(h));}catch(c){o(c);}}function u(h){try{a(n.throw(h));}catch(c){o(c);}}function a(h){h.done?r(h.value):s(h.value).then(l,u);}a((n=n.apply(i,e||[])).next());})},dr=_&&_.__generator||function(i,e){var t={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},n,s,r,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(a){return function(h){return u([a,h])}}function u(a){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,s&&(r=a[0]&2?s.return:a[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,a[1])).done)return r;switch(s=0,r&&(a=[a[0]&2,r.value]),a[0]){case 0:case 1:r=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,s=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(r=t.trys,!(r=r.length>0&&r[r.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!r||a[1]>r[0]&&a[1]<r[3])){t.label=a[1];break}if(a[0]===6&&t.label<r[1]){t.label=r[1],r=a;break}if(r&&t.label<r[2]){t.label=r[2],t.ops.push(a);break}r[2]&&t.ops.pop(),t.trys.pop();continue}a=e.call(i,t);}catch(h){a=[6,h],s=0;}finally{n=r=0;}if(a[0]&5)throw a[1];return {value:a[0]?a[1]:void 0,done:!0}}},pr=_&&_.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(_,"__esModule",{value:!0});_.HTTPTransport=void 0;var gr=pr(un()),mr=de(),pt=pe(),hn=ce(),cn=function(i){cr(e,i);function e(t,n){var s=i.call(this)||this;return s.onlyNotifications=function(r){return r instanceof Array?r.every(function(o){return o.request.request.id===null||o.request.request.id===void 0}):r.request.id===null||r.request.id===void 0},s.uri=t,s.credentials=n&&n.credentials,s.headers=e.setupHeaders(n&&n.headers),s.injectedFetcher=n?.fetcher,s}return e.prototype.connect=function(){return Promise.resolve()},e.prototype.sendData=function(t,n){return n===void 0&&(n=null),fr(this,void 0,void 0,function(){var s,r,o,l,u,a,c,h,c;return dr(this,function(f){switch(f.label){case 0:s=this.transportRequestManager.addRequest(t,n),r=pt.getNotifications(t),o=pt.getBatchRequests(t),l=this.injectedFetcher||gr.default,f.label=1;case 1:return f.trys.push([1,4,,5]),[4,l(this.uri,{method:"POST",headers:this.headers,body:JSON.stringify(this.parseData(t)),credentials:this.credentials})];case 2:return u=f.sent(),this.transportRequestManager.settlePendingRequest(r),this.onlyNotifications(t)?[2,Promise.resolve()]:[4,u.text()];case 3:return a=f.sent(),c=this.transportRequestManager.resolveResponse(a),c?(this.transportRequestManager.settlePendingRequest(o,c),[2,Promise.reject(c)]):[3,5];case 4:return h=f.sent(),c=new hn.JSONRPCError(h.message,hn.ERR_UNKNOWN,h),this.transportRequestManager.settlePendingRequest(r,c),this.transportRequestManager.settlePendingRequest(pt.getBatchRequests(t),c),[2,Promise.reject(c)];case 5:return [2,s]}})})},e.prototype.close=function(){},e.setupHeaders=function(t){var n=new Headers(t);return n.set("Content-Type","application/json"),n},e}(mr.Transport);_.HTTPTransport=cn;_.default=cn;});var dn={};d(dn,{default:()=>vr});var me,vr,pn=b(()=>{j();h();me=null;typeof WebSocket<"u"?me=WebSocket:typeof MozWebSocket<"u"?me=MozWebSocket:typeof globalThis<"u"?me=globalThis.WebSocket||globalThis.MozWebSocket:typeof window<"u"?me=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(me=self.WebSocket||self.MozWebSocket);vr=me;});var vn=c(D=>{j();h();var yr=D&&D.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s;}||function(n,s){for(var r in s)s.hasOwnProperty(r)&&(n[r]=s[r]);},i(e,t)};return function(e,t){i(e,t);function n(){this.constructor=e;}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n);}}(),wr=D&&D.__awaiter||function(i,e,t,n){function s(r){return r instanceof t?r:new t(function(o){o(r);})}return new(t||(t=Promise))(function(r,o){function l(h){try{a(n.next(h));}catch(c){o(c);}}function u(h){try{a(n.throw(h));}catch(c){o(c);}}function a(h){h.done?r(h.value):s(h.value).then(l,u);}a((n=n.apply(i,e||[])).next());})},Rr=D&&D.__generator||function(i,e){var t={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},n,s,r,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(a){return function(h){return u([a,h])}}function u(a){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,s&&(r=a[0]&2?s.return:a[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,a[1])).done)return r;switch(s=0,r&&(a=[a[0]&2,r.value]),a[0]){case 0:case 1:r=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,s=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(r=t.trys,!(r=r.length>0&&r[r.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!r||a[1]>r[0]&&a[1]<r[3])){t.label=a[1];break}if(a[0]===6&&t.label<r[1]){t.label=r[1],r=a;break}if(r&&t.label<r[2]){t.label=r[2],t.ops.push(a);break}r[2]&&t.ops.pop(),t.trys.pop();continue}a=e.call(i,t);}catch(h){a=[6,h],s=0;}finally{n=r=0;}if(a[0]&5)throw a[1];return {value:a[0]?a[1]:void 0,done:!0}}},br=D&&D.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(D,"__esModule",{value:!0});var Sr=br((pn(),f(dn))),xr=de(),gn=pe(),mn=ce(),Pr=function(i){yr(e,i);function e(t){var n=i.call(this)||this;return n.uri=t,n.connection=new Sr.default(t),n}return e.prototype.connect=function(){var t=this;return new Promise(function(n,s){var r=function(){t.connection.removeEventListener("open",r),n();};t.connection.addEventListener("open",r),t.connection.addEventListener("message",function(o){var l=o.data;t.transportRequestManager.resolveResponse(l);});})},e.prototype.sendData=function(t,n){return n===void 0&&(n=5e3),wr(this,void 0,void 0,function(){var s,r,o;return Rr(this,function(l){s=this.transportRequestManager.addRequest(t,n),r=gn.getNotifications(t);try{this.connection.send(JSON.stringify(this.parseData(t))),this.transportRequestManager.settlePendingRequest(r);}catch(u){o=new mn.JSONRPCError(u.message,mn.ERR_UNKNOWN,u),this.transportRequestManager.settlePendingRequest(r,o),this.transportRequestManager.settlePendingRequest(gn.getBatchRequests(t),o),s=Promise.reject(o);}return [2,s]})})},e.prototype.close=function(){this.connection.close();},e}(xr.Transport);D.default=Pr;});var Rn=c(F=>{j();h();var qr=F&&F.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s;}||function(n,s){for(var r in s)s.hasOwnProperty(r)&&(n[r]=s[r]);},i(e,t)};return function(e,t){i(e,t);function n(){this.constructor=e;}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n);}}(),yn=F&&F.__awaiter||function(i,e,t,n){function s(r){return r instanceof t?r:new t(function(o){o(r);})}return new(t||(t=Promise))(function(r,o){function l(h){try{a(n.next(h));}catch(c){o(c);}}function u(h){try{a(n.throw(h));}catch(c){o(c);}}function a(h){h.done?r(h.value):s(h.value).then(l,u);}a((n=n.apply(i,e||[])).next());})},wn=F&&F.__generator||function(i,e){var t={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},n,s,r,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(a){return function(h){return u([a,h])}}function u(a){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,s&&(r=a[0]&2?s.return:a[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,a[1])).done)return r;switch(s=0,r&&(a=[a[0]&2,r.value]),a[0]){case 0:case 1:r=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,s=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(r=t.trys,!(r=r.length>0&&r[r.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!r||a[1]>r[0]&&a[1]<r[3])){t.label=a[1];break}if(a[0]===6&&t.label<r[1]){t.label=r[1],r=a;break}if(r&&t.label<r[2]){t.label=r[2],t.ops.push(a);break}r[2]&&t.ops.pop(),t.trys.pop();continue}a=e.call(i,t);}catch(h){a=[6,h],s=0;}finally{n=r=0;}if(a[0]&5)throw a[1];return {value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(F,"__esModule",{value:!0});var kr=de(),Er=pe(),Ir=function(i){var e=400,t=window.screen.height,n=0,s=0;return window.open(i,"inspector:popup","left="+n+",top="+s+",width="+e+",height="+t+",resizable,scrollbars=yes,status=1")},Tr=function(i){qr(e,i);function e(t){var n=i.call(this)||this;return n.messageHandler=function(s){n.transportRequestManager.resolveResponse(JSON.stringify(s.data));},n.uri=t,n.postMessageID="post-message-transport-"+Math.random(),n}return e.prototype.createWindow=function(t){return new Promise(function(n,s){var r;r=Ir(t),setTimeout(function(){n(r);},3e3);})},e.prototype.connect=function(){var t=this,n=/^(http|https):\/\/.*$/;return new Promise(function(s,r){return yn(t,void 0,void 0,function(){var o;return wn(this,function(l){switch(l.label){case 0:return n.test(this.uri)||r(new Error("Bad URI")),o=this,[4,this.createWindow(this.uri)];case 1:return o.frame=l.sent(),window.addEventListener("message",this.messageHandler),s(),[2]}})})})},e.prototype.sendData=function(t,n){return yn(this,void 0,void 0,function(){var s,r;return wn(this,function(o){return s=this.transportRequestManager.addRequest(t,null),r=Er.getNotifications(t),this.frame&&(this.frame.postMessage(t.request,this.uri),this.transportRequestManager.settlePendingRequest(r)),[2,s]})})},e.prototype.close=function(){this.frame&&(window.removeEventListener("message",this.messageHandler),this.frame.close());},e}(kr.Transport);F.default=Tr;});var xn=c(W=>{j();h();var Cr=W&&W.__extends||function(){var i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s;}||function(n,s){for(var r in s)s.hasOwnProperty(r)&&(n[r]=s[r]);},i(e,t)};return function(e,t){i(e,t);function n(){this.constructor=e;}e.prototype=t===null?Object.create(t):(n.prototype=t.prototype,new n);}}(),bn=W&&W.__awaiter||function(i,e,t,n){function s(r){return r instanceof t?r:new t(function(o){o(r);})}return new(t||(t=Promise))(function(r,o){function l(h){try{a(n.next(h));}catch(c){o(c);}}function u(h){try{a(n.throw(h));}catch(c){o(c);}}function a(h){h.done?r(h.value):s(h.value).then(l,u);}a((n=n.apply(i,e||[])).next());})},Sn=W&&W.__generator||function(i,e){var t={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},n,s,r,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(a){return function(h){return u([a,h])}}function u(a){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,s&&(r=a[0]&2?s.return:a[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,a[1])).done)return r;switch(s=0,r&&(a=[a[0]&2,r.value]),a[0]){case 0:case 1:r=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,s=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(r=t.trys,!(r=r.length>0&&r[r.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!r||a[1]>r[0]&&a[1]<r[3])){t.label=a[1];break}if(a[0]===6&&t.label<r[1]){t.label=r[1],r=a;break}if(r&&t.label<r[2]){t.label=r[2],t.ops.push(a);break}r[2]&&t.ops.pop(),t.trys.pop();continue}a=e.call(i,t);}catch(h){a=[6,h],s=0;}finally{n=r=0;}if(a[0]&5)throw a[1];return {value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(W,"__esModule",{value:!0});var Or=de(),_r=pe(),Nr=function(i){Cr(e,i);function e(t){var n=i.call(this)||this;return n.messageHandler=function(s){n.transportRequestManager.resolveResponse(JSON.stringify(s.data));},n.uri=t,n.postMessageID="post-message-transport-"+Math.random(),n}return e.prototype.createWindow=function(t){var n=this;return new Promise(function(s,r){var o,l=document.createElement("iframe");l.setAttribute("id",n.postMessageID),l.setAttribute("width","0px"),l.setAttribute("height","0px"),l.setAttribute("style","visiblity:hidden;border:none;outline:none;"),l.addEventListener("load",function(){s(o);}),l.setAttribute("src",t),window.document.body.appendChild(l),o=l.contentWindow;})},e.prototype.connect=function(){var t=this,n=/^(http|https):\/\/.*$/;return new Promise(function(s,r){return bn(t,void 0,void 0,function(){var o;return Sn(this,function(l){switch(l.label){case 0:return n.test(this.uri)||r(new Error("Bad URI")),o=this,[4,this.createWindow(this.uri)];case 1:return o.frame=l.sent(),window.addEventListener("message",this.messageHandler),s(),[2]}})})})},e.prototype.sendData=function(t,n){return bn(this,void 0,void 0,function(){var s,r;return Sn(this,function(o){return s=this.transportRequestManager.addRequest(t,null),r=_r.getNotifications(t),this.frame&&(this.frame.postMessage(t.request,"*"),this.transportRequestManager.settlePendingRequest(r)),[2,s]})})},e.prototype.close=function(){var t=document.getElementById(this.postMessageID);t?.remove(),window.removeEventListener("message",this.messageHandler);},e}(Or.Transport);W.default=Nr;});var kn=c(ne=>{j();h();var Pn=ne&&ne.__awaiter||function(i,e,t,n){function s(r){return r instanceof t?r:new t(function(o){o(r);})}return new(t||(t=Promise))(function(r,o){function l(h){try{a(n.next(h));}catch(c){o(c);}}function u(h){try{a(n.throw(h));}catch(c){o(c);}}function a(h){h.done?r(h.value):s(h.value).then(l,u);}a((n=n.apply(i,e||[])).next());})},qn=ne&&ne.__generator||function(i,e){var t={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},n,s,r,o;return o={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function l(a){return function(h){return u([a,h])}}function u(a){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,s&&(r=a[0]&2?s.return:a[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,a[1])).done)return r;switch(s=0,r&&(a=[a[0]&2,r.value]),a[0]){case 0:case 1:r=a;break;case 4:return t.label++,{value:a[1],done:!1};case 5:t.label++,s=a[1],a=[0];continue;case 7:a=t.ops.pop(),t.trys.pop();continue;default:if(r=t.trys,!(r=r.length>0&&r[r.length-1])&&(a[0]===6||a[0]===2)){t=0;continue}if(a[0]===3&&(!r||a[1]>r[0]&&a[1]<r[3])){t.label=a[1];break}if(a[0]===6&&t.label<r[1]){t.label=r[1],r=a;break}if(r&&t.label<r[2]){t.label=r[2],t.ops.push(a);break}r[2]&&t.ops.pop(),t.trys.pop();continue}a=e.call(i,t);}catch(h){a=[6,h],s=0;}finally{n=r=0;}if(a[0]&5)throw a[1];return {value:a[0]?a[1]:void 0,done:!0}}};Object.defineProperty(ne,"__esModule",{value:!0});var Mr=function(){function i(e){this.requestManager=e;}return i.prototype.startBatch=function(){return this.requestManager.startBatch()},i.prototype.stopBatch=function(){return this.requestManager.stopBatch()},i.prototype.request=function(e,t){return Pn(this,void 0,void 0,function(){return qn(this,function(n){switch(n.label){case 0:return this.requestManager.connectPromise?[4,this.requestManager.connectPromise]:[3,2];case 1:n.sent(),n.label=2;case 2:return [2,this.requestManager.request(e,!1,t)]}})})},i.prototype.notify=function(e){return Pn(this,void 0,void 0,function(){return qn(this,function(t){switch(t.label){case 0:return this.requestManager.connectPromise?[4,this.requestManager.connectPromise]:[3,2];case 1:t.sent(),t.label=2;case 2:return [2,this.requestManager.request(e,!0,null)]}})})},i.prototype.onNotification=function(e){this.requestManager.requestChannel.addListener("notification",e);},i.prototype.onError=function(e){this.requestManager.requestChannel.addListener("error",e);},i.prototype.close=function(){this.requestManager.close();},i}();ne.default=Mr;});var In=c(w=>{j();h();var re=w&&w.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(w,"__esModule",{value:!0});w.PostMessageIframeTransport=w.PostMessageWindowTransport=w.JSONRPCError=w.WebSocketTransport=w.EventEmitterTransport=w.HTTPTransport=w.RequestManager=w.Client=void 0;var Ar=re(Qt());w.RequestManager=Ar.default;var Dr=re(Yt());w.EventEmitterTransport=Dr.default;var Br=re(fn());w.HTTPTransport=Br.default;var Jr=re(vn());w.WebSocketTransport=Jr.default;var jr=re(Rn());w.PostMessageWindowTransport=jr.default;var Lr=re(xn());w.PostMessageIframeTransport=Lr.default;var Fr=ce();Object.defineProperty(w,"JSONRPCError",{enumerable:!0,get:function(){return Fr.JSONRPCError}});var En=re(kn());w.Client=En.default;w.default=En.default;});j();h();j();h();j();h();j();h();p();j();h();j();h();p();j();h();var K=class extends Error{constructor(t,n,s){super(t);this.message=t,this.code=n,this.data=s,Object.setPrototypeOf(this,new.target.prototype);}},$e=i=>{if(i.error){let{message:e,code:t,data:n}=i.error;return new K(e,t,n)}return new K("Unknown error",7979,i)};var Ee=class{constructor(){this.pendingRequest={},this.pendingBatchRequest={},this.transportEventChannel=new n;}addRequest(e,t){return this.transportEventChannel.emit("pending",e),e instanceof Array?(this.addBatchReq(e,t),Promise.resolve()):this.addReq(e.internalID,t)}settlePendingRequest(e,t){e.forEach(n=>{let s=this.pendingRequest[n.internalID];if(delete this.pendingBatchRequest[n.internalID],s!==void 0){if(t){s.reject(t);return}s.resolve(),(n.request.id===null||n.request.id===void 0)&&delete this.pendingRequest[n.internalID];}});}isPendingRequest(e){return this.pendingRequest.hasOwnProperty(e)}resolveResponse(e,t=!0){let n=e;try{return n=JSON.parse(e),this.checkJSONRPC(n)===!1?void 0:n instanceof Array?this.resolveBatch(n,t):this.resolveRes(n,t)}catch{let r=new K("Bad response format",7979,e);return t&&this.transportEventChannel.emit("error",r),r}}addBatchReq(e,t){return e.forEach(n=>{let{resolve:s,reject:r}=n,{internalID:o}=n.request;this.pendingBatchRequest[o]=!0,this.pendingRequest[o]={resolve:s,reject:r};}),Promise.resolve()}addReq(e,t){return new Promise((n,s)=>{t!==null&&t&&this.setRequestTimeout(e,t,s),this.pendingRequest[e]={resolve:n,reject:s};})}checkJSONRPC(e){let t=[e];return e instanceof Array&&(t=e),t.every(n=>n.result!==void 0||n.error!==void 0||n.method!==void 0)}processResult(e,t){if(e.error){let n=$e(e);t.reject(n);return}t.resolve(e.result);}resolveBatch(e,t){let s=e.map(r=>this.resolveRes(r,t)).filter(r=>r);if(s.length>0)return s[0]}resolveRes(e,t){let{id:n,error:s}=e,r=this.pendingRequest[n];if(r){delete this.pendingRequest[n],this.processResult(e,r),this.transportEventChannel.emit("response",e);return}if(n===void 0&&s===void 0){this.transportEventChannel.emit("notification",e);return}let o;return s&&(o=$e(e)),t&&s&&o&&this.transportEventChannel.emit("error",o),o}setRequestTimeout(e,t,n){setTimeout(()=>{delete this.pendingRequest[e],n(new K(`Request timeout request took longer than ${t} ms to resolve`,7777));},t);}};var Ie=class{constructor(){this.transportRequestManager=new Ee,this.transportRequestManager.transportEventChannel.on("error",()=>{});}subscribe(e,t){this.transportRequestManager.transportEventChannel.addListener(e,t);}unsubscribe(e,t){if(!e)return this.transportRequestManager.transportEventChannel.removeAllListeners();e&&t&&this.transportRequestManager.transportEventChannel.removeListener(e,t);}parseData(e){return e instanceof Array?e.map(t=>t.request.request):e.request}};j();h();var St=i=>i.request.id===void 0||i.request.id===null;var xt=i=>i instanceof Array?i.filter(e=>St(e.request)).map(e=>e.request):St(i)?[i]:[];var ve=class extends Ie{constructor(t){super();this.messageHandler=t=>{console.debug("<-",t.data),this.transportRequestManager.resolveResponse(JSON.stringify(t.data));};this.worker=t,this.postMessageID=`post-message-transport-${Math.random()}`;}connect(){return new Promise(async(t,n)=>{this.worker.addEventListener("message",this.messageHandler),t();})}async sendData(t,n=5e3){console.debug("->",t);let s=this.transportRequestManager.addRequest(t,null),r=xt(t);return this.worker&&(this.worker.postMessage(t.request),this.transportRequestManager.settlePendingRequest(r)),s}close(){this.worker.terminate();}};j();h();j();h();var S=class i{lineAt(e){if(e<0||e>this.length)throw new RangeError(`Invalid position ${e} in document of length ${this.length}`);return this.lineInner(e,!1,1,0)}line(e){if(e<1||e>this.lines)throw new RangeError(`Invalid line number ${e} in ${this.lines}-line document`);return this.lineInner(e,!0,1,0)}replace(e,t,n){let s=[];return this.decompose(0,e,s,2),n.length&&n.decompose(0,n.length,s,3),this.decompose(t,this.length,s,1),se.from(s,this.length-(t-e)+n.length)}append(e){return this.replace(this.length,this.length,e)}slice(e,t=this.length){let n=[];return this.decompose(e,t,n,0),se.from(n,t-e)}eq(e){if(e==this)return !0;if(e.length!=this.length||e.lines!=this.lines)return !1;let t=this.scanIdentical(e,1),n=this.length-this.scanIdentical(e,-1),s=new Z(this),r=new Z(e);for(let o=t,l=t;;){if(s.next(o),r.next(o),o=0,s.lineBreak!=r.lineBreak||s.done!=r.done||s.value!=r.value)return !1;if(l+=s.value.length,s.done||l>=n)return !0}}iter(e=1){return new Z(this,e)}iterRange(e,t=this.length){return new _e(this,e,t)}iterLines(e,t){let n;if(e==null)n=this.iter();else {t==null&&(t=this.lines+1);let s=this.line(e).from;n=this.iterRange(s,Math.max(s,t==this.lines+1?this.length:t<=1?0:this.line(t-1).to));}return new Ne(n)}toString(){return this.sliceString(0)}toJSON(){let e=[];return this.flatten(e),e}constructor(){}static of(e){if(e.length==0)throw new RangeError("A document must have at least one line");return e.length==1&&!e[0]?i.empty:e.length<=32?new O(e):se.from(O.split(e,[]))}},O=class i extends S{constructor(e,t=_n(e)){super(),this.text=e,this.length=t;}get lines(){return this.text.length}get children(){return null}lineInner(e,t,n,s){for(let r=0;;r++){let o=this.text[r],l=s+o.length;if((t?n:l)>=e)return new Ke(s,l,n,o);s=l+1,n++;}}decompose(e,t,n,s){let r=e<=0&&t>=this.length?this:new i(Pt(this.text,e,t),Math.min(t,this.length)-Math.max(0,e));if(s&1){let o=n.pop(),l=Oe(r.text,o.text.slice(),0,r.length);if(l.length<=32)n.push(new i(l,o.length+r.length));else {let u=l.length>>1;n.push(new i(l.slice(0,u)),new i(l.slice(u)));}}else n.push(r);}replace(e,t,n){if(!(n instanceof i))return super.replace(e,t,n);let s=Oe(this.text,Oe(n.text,Pt(this.text,0,e)),t),r=this.length+n.length-(t-e);return s.length<=32?new i(s,r):se.from(i.split(s,[]),r)}sliceString(e,t=this.length,n=`
`){let s="";for(let r=0,o=0;r<=t&&o<this.text.length;o++){let l=this.text[o],u=r+l.length;r>e&&o&&(s+=n),e<u&&t>r&&(s+=l.slice(Math.max(0,e-r),t-r)),r=u+1;}return s}flatten(e){for(let t of this.text)e.push(t);}scanIdentical(){return 0}static split(e,t){let n=[],s=-1;for(let r of e)n.push(r),s+=r.length+1,n.length==32&&(t.push(new i(n,s)),n=[],s=-1);return s>-1&&t.push(new i(n,s)),t}},se=class i extends S{constructor(e,t){super(),this.children=e,this.length=t,this.lines=0;for(let n of e)this.lines+=n.lines;}lineInner(e,t,n,s){for(let r=0;;r++){let o=this.children[r],l=s+o.length,u=n+o.lines-1;if((t?u:l)>=e)return o.lineInner(e,t,n,s);s=l+1,n=u+1;}}decompose(e,t,n,s){for(let r=0,o=0;o<=t&&r<this.children.length;r++){let l=this.children[r],u=o+l.length;if(e<=u&&t>=o){let a=s&((o<=e?1:0)|(u>=t?2:0));o>=e&&u<=t&&!a?n.push(l):l.decompose(e-o,t-o,n,a);}o=u+1;}}replace(e,t,n){if(n.lines<this.lines)for(let s=0,r=0;s<this.children.length;s++){let o=this.children[s],l=r+o.length;if(e>=r&&t<=l){let u=o.replace(e-r,t-r,n),a=this.lines-o.lines+u.lines;if(u.lines<a>>5-1&&u.lines>a>>5+1){let h=this.children.slice();return h[s]=u,new i(h,this.length-(t-e)+n.length)}return super.replace(r,l,u)}r=l+1;}return super.replace(e,t,n)}sliceString(e,t=this.length,n=`
`){let s="";for(let r=0,o=0;r<this.children.length&&o<=t;r++){let l=this.children[r],u=o+l.length;o>e&&r&&(s+=n),e<u&&t>o&&(s+=l.sliceString(e-o,t-o,n)),o=u+1;}return s}flatten(e){for(let t of this.children)t.flatten(e);}scanIdentical(e,t){if(!(e instanceof i))return 0;let n=0,[s,r,o,l]=t>0?[0,0,this.children.length,e.children.length]:[this.children.length-1,e.children.length-1,-1,-1];for(;;s+=t,r+=t){if(s==o||r==l)return n;let u=this.children[s],a=e.children[r];if(u!=a)return n+u.scanIdentical(a,t);n+=u.length+1;}}static from(e,t=e.reduce((n,s)=>n+s.length+1,-1)){let n=0;for(let d of e)n+=d.lines;if(n<32){let d=[];for(let m of e)m.flatten(d);return new O(d,t)}let s=Math.max(32,n>>5),r=s<<1,o=s>>1,l=[],u=0,a=-1,h=[];function c(d){let m;if(d.lines>r&&d instanceof i)for(let B of d.children)c(B);else d.lines>o&&(u>o||!u)?(f(),l.push(d)):d instanceof O&&u&&(m=h[h.length-1])instanceof O&&d.lines+m.lines<=32?(u+=d.lines,a+=d.length+1,h[h.length-1]=new O(m.text.concat(d.text),m.length+1+d.length)):(u+d.lines>s&&f(),u+=d.lines,a+=d.length+1,h.push(d));}function f(){u!=0&&(l.push(h.length==1?h[0]:i.from(h,a)),a=-1,u=h.length=0);}for(let d of e)c(d);return f(),l.length==1?l[0]:new i(l,t)}};S.empty=new O([""],0);function _n(i){let e=-1;for(let t of i)e+=t.length+1;return e}function Oe(i,e,t=0,n=1e9){for(let s=0,r=0,o=!0;r<i.length&&s<=n;r++){let l=i[r],u=s+l.length;u>=t&&(u>n&&(l=l.slice(0,n-s)),s<t&&(l=l.slice(t-s)),o?(e[e.length-1]+=l,o=!1):e.push(l)),s=u+1;}return e}function Pt(i,e,t){return Oe(i,[""],e,t)}var Z=class{constructor(e,t=1){this.dir=t,this.done=!1,this.lineBreak=!1,this.value="",this.nodes=[e],this.offsets=[t>0?1:(e instanceof O?e.text.length:e.children.length)<<1];}nextInner(e,t){for(this.done=this.lineBreak=!1;;){let n=this.nodes.length-1,s=this.nodes[n],r=this.offsets[n],o=r>>1,l=s instanceof O?s.text.length:s.children.length;if(o==(t>0?l:0)){if(n==0)return this.done=!0,this.value="",this;t>0&&this.offsets[n-1]++,this.nodes.pop(),this.offsets.pop();}else if((r&1)==(t>0?0:1)){if(this.offsets[n]+=t,e==0)return this.lineBreak=!0,this.value=`
`,this;e--;}else if(s instanceof O){let u=s.text[o+(t<0?-1:0)];if(this.offsets[n]+=t,u.length>Math.max(0,e))return this.value=e==0?u:t>0?u.slice(e):u.slice(0,u.length-e),this;e-=u.length;}else {let u=s.children[o+(t<0?-1:0)];e>u.length?(e-=u.length,this.offsets[n]+=t):(t<0&&this.offsets[n]--,this.nodes.push(u),this.offsets.push(t>0?1:(u instanceof O?u.text.length:u.children.length)<<1));}}}next(e=0){return e<0&&(this.nextInner(-e,-this.dir),e=this.value.length),this.nextInner(e,this.dir)}},_e=class{constructor(e,t,n){this.value="",this.done=!1,this.cursor=new Z(e,t>n?-1:1),this.pos=t>n?e.length:0,this.from=Math.min(t,n),this.to=Math.max(t,n);}nextInner(e,t){if(t<0?this.pos<=this.from:this.pos>=this.to)return this.value="",this.done=!0,this;e+=Math.max(0,t<0?this.pos-this.to:this.from-this.pos);let n=t<0?this.pos-this.from:this.to-this.pos;e>n&&(e=n),n-=e;let{value:s}=this.cursor.next(e);return this.pos+=(s.length+e)*t,this.value=s.length<=n?s:t<0?s.slice(s.length-n):s.slice(0,n),this.done=!this.value,this}next(e=0){return e<0?e=Math.max(e,this.from-this.pos):e>0&&(e=Math.min(e,this.to-this.pos)),this.nextInner(e,this.cursor.dir)}get lineBreak(){return this.cursor.lineBreak&&this.value!=""}},Ne=class{constructor(e){this.inner=e,this.afterBreak=!0,this.value="",this.done=!1;}next(e=0){let{done:t,lineBreak:n,value:s}=this.inner.next(e);return t?(this.done=!0,this.value=""):n?this.afterBreak?this.value="":(this.afterBreak=!0,this.next()):(this.value=s,this.afterBreak=!1),this}get lineBreak(){return !1}};typeof Symbol<"u"&&(S.prototype[Symbol.iterator]=function(){return this.iter()},Z.prototype[Symbol.iterator]=_e.prototype[Symbol.iterator]=Ne.prototype[Symbol.iterator]=function(){return this});var Ke=class{constructor(e,t,n,s){this.from=e,this.to=t,this.number=n,this.text=s;}get length(){return this.to-this.from}},oe="lc,34,7n,7,7b,19,,,,2,,2,,,20,b,1c,l,g,,2t,7,2,6,2,2,,4,z,,u,r,2j,b,1m,9,9,,o,4,,9,,3,,5,17,3,3b,f,,w,1j,,,,4,8,4,,3,7,a,2,t,,1m,,,,2,4,8,,9,,a,2,q,,2,2,1l,,4,2,4,2,2,3,3,,u,2,3,,b,2,1l,,4,5,,2,4,,k,2,m,6,,,1m,,,2,,4,8,,7,3,a,2,u,,1n,,,,c,,9,,14,,3,,1l,3,5,3,,4,7,2,b,2,t,,1m,,2,,2,,3,,5,2,7,2,b,2,s,2,1l,2,,,2,4,8,,9,,a,2,t,,20,,4,,2,3,,,8,,29,,2,7,c,8,2q,,2,9,b,6,22,2,r,,,,,,1j,e,,5,,2,5,b,,10,9,,2u,4,,6,,2,2,2,p,2,4,3,g,4,d,,2,2,6,,f,,jj,3,qa,3,t,3,t,2,u,2,1s,2,,7,8,,2,b,9,,19,3,3b,2,y,,3a,3,4,2,9,,6,3,63,2,2,,1m,,,7,,,,,2,8,6,a,2,,1c,h,1r,4,1c,7,,,5,,14,9,c,2,w,4,2,2,,3,1k,,,2,3,,,3,1m,8,2,2,48,3,,d,,7,4,,6,,3,2,5i,1m,,5,ek,,5f,x,2da,3,3x,,2o,w,fe,6,2x,2,n9w,4,,a,w,2,28,2,7k,,3,,4,,p,2,5,,47,2,q,i,d,,12,8,p,b,1a,3,1c,,2,4,2,2,13,,1v,6,2,2,2,2,c,,8,,1b,,1f,,,3,2,2,5,2,,,16,2,8,,6m,,2,,4,,fn4,,kh,g,g,g,a6,2,gt,,6a,,45,5,1ae,3,,2,5,4,14,3,4,,4l,2,fx,4,ar,2,49,b,4w,,1i,f,1k,3,1d,4,2,2,1x,3,10,5,,8,1q,,c,2,1g,9,a,4,2,,2n,3,2,,,2,6,,4g,,3,8,l,2,1l,2,,,,,m,,e,7,3,5,5f,8,2,3,,,n,,29,,2,6,,,2,,,2,,2,6j,,2,4,6,2,,2,r,2,2d,8,2,,,2,2y,,,,2,6,,,2t,3,2,4,,5,77,9,,2,6t,,a,2,,,4,,40,4,2,2,4,,w,a,14,6,2,4,8,,9,6,2,3,1a,d,,2,ba,7,,6,,,2a,m,2,7,,2,,2,3e,6,3,,,2,,7,,,20,2,3,,,,9n,2,f0b,5,1n,7,t4,,1r,4,29,,f5k,2,43q,,,3,4,5,8,8,2,7,u,4,44,3,1iz,1j,4,1e,8,,e,,m,5,,f,11s,7,,h,2,7,,2,,5,79,7,c5,4,15s,7,31,7,240,5,gx7k,2o,3k,6o".split(",").map(i=>i?parseInt(i,36):1);for(let i=1;i<oe.length;i++)oe[i]+=oe[i-1];var U=function(i){return i[i.Simple=0]="Simple",i[i.TrackDel=1]="TrackDel",i[i.TrackBefore=2]="TrackBefore",i[i.TrackAfter=3]="TrackAfter",i}(U||(U={}));var at=0,x=class i{constructor(e,t,n,s,r){this.combine=e,this.compareInput=t,this.compare=n,this.isStatic=s,this.id=at++,this.default=e([]),this.extensions=typeof r=="function"?r(this):r;}static define(e={}){return new i(e.combine||(t=>t),e.compareInput||((t,n)=>t===n),e.compare||(e.combine?(t,n)=>t===n:lt),!!e.static,e.enables)}of(e){return new ae([],this,0,e)}compute(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new ae(e,this,1,t)}computeN(e,t){if(this.isStatic)throw new Error("Can't compute a static facet");return new ae(e,this,2,t)}from(e,t){return t||(t=n=>n),this.compute([e],n=>t(n.field(e)))}};function lt(i,e){return i==e||i.length==e.length&&i.every((t,n)=>t===e[n])}var ae=class{constructor(e,t,n,s){this.dependencies=e,this.facet=t,this.type=n,this.value=s,this.id=at++;}dynamicSlot(e){var t;let n=this.value,s=this.facet.compareInput,r=this.id,o=e[r]>>1,l=this.type==2,u=!1,a=!1,h=[];for(let c of this.dependencies)c=="doc"?u=!0:c=="selection"?a=!0:((t=e[c.id])!==null&&t!==void 0?t:1)&1||h.push(e[c.id]);return {create(c){return c.values[o]=n(c),1},update(c,f){if(u&&f.docChanged||a&&(f.docChanged||f.selection)||Ye(c,h)){let d=n(c);if(l?!Tt(d,c.values[o],s):!s(d,c.values[o]))return c.values[o]=d,1}return 0},reconfigure:(c,f)=>{let d,m=f.config.address[r];if(m!=null){let B=Be(f,m);if(this.dependencies.every(b=>b instanceof x?f.facet(b)===c.facet(b):b instanceof ue?f.field(b,!1)==c.field(b,!1):!0)||(l?Tt(d=n(c),B,s):s(d=n(c),B)))return c.values[o]=B,0}else d=n(c);return c.values[o]=d,1}}}};function Tt(i,e,t){if(i.length!=e.length)return !1;for(let n=0;n<i.length;n++)if(!t(i[n],e[n]))return !1;return !0}function Ye(i,e){let t=!1;for(let n of e)we(i,n)&1&&(t=!0);return t}var Ct=x.define({static:!0}),ue=class i{constructor(e,t,n,s,r){this.id=e,this.createF=t,this.updateF=n,this.compareF=s,this.spec=r,this.provides=void 0;}static define(e){let t=new i(at++,e.create,e.update,e.compare||((n,s)=>n===s),e);return e.provide&&(t.provides=e.provide(t)),t}create(e){let t=e.facet(Ct).find(n=>n.field==this);return (t?.create||this.createF)(e)}slot(e){let t=e[this.id]>>1;return {create:n=>(n.values[t]=this.create(n),1),update:(n,s)=>{let r=n.values[t],o=this.updateF(r,s);return this.compareF(r,o)?0:(n.values[t]=o,1)},reconfigure:(n,s)=>s.config.address[this.id]!=null?(n.values[t]=s.field(this),0):(n.values[t]=this.create(n),1)}}init(e){return [this,Ct.of({field:this,create:e})]}get extension(){return this}};function we(i,e){if(e&1)return 2;let t=e>>1,n=i.status[t];if(n==4)throw new Error("Cyclic dependency between fields and/or facets");if(n&2)return n;i.status[t]=4;let s=i.computeSlot(i,i.config.dynamicSlots[t]);return i.status[t]=2|s}function Be(i,e){return e&1?i.config.staticValues[e>>1]:i.values[e>>1]}x.define();x.define({combine:i=>i.some(e=>e),static:!0});x.define({combine:i=>i.length?i[0]:void 0,static:!0});x.define();x.define();x.define();x.define({combine:i=>i.length?i[0]:!1});var tt=class{constructor(e){this.map=e;}of(e){return new k(this,e)}},k=class i{constructor(e,t){this.type=e,this.value=t;}map(e){let t=this.type.map(this.value,e);return t===void 0?void 0:t==this.value?this:new i(this.type,t)}is(e){return this.type==e}static define(e={}){return new tt(e.map||(t=>t))}static mapEffects(e,t){if(!e.length)return e;let n=[];for(let s of e){let r=s.map(t);r&&n.push(r);}return n}};k.reconfigure=k.define();k.appendConfig=k.define();var z=function(i){return i[i.Word=0]="Word",i[i.Space=1]="Space",i[i.Other=2]="Other",i}(z||(z={})),rt;try{rt=new RegExp("[\\p{Alphabetic}\\p{Number}_]","u");}catch{}x.define({combine:i=>i.length?i[0]:4});x.define({compare(i,e){let t=Object.keys(i),n=Object.keys(e);return t.length==n.length&&t.every(s=>i[s]==e[s])}});k.define();U.TrackDel;var be=class i{constructor(e,t,n){this.from=e,this.to=t,this.value=n;}static create(e,t,n){return new i(e,t,n)}};function it(i,e){return i.from-e.from||i.value.startSide-e.value.startSide}var st=class i{constructor(e,t,n,s){this.from=e,this.to=t,this.value=n,this.maxPoint=s;}get length(){return this.to[this.to.length-1]}findIndex(e,t,n,s=0){let r=n?this.to:this.from;for(let o=s,l=r.length;;){if(o==l)return o;let u=o+l>>1,a=r[u]-e||(n?this.value[u].endSide:this.value[u].startSide)-t;if(u==o)return a>=0?o:l;a>=0?l=u:o=u+1;}}between(e,t,n,s){for(let r=this.findIndex(t,-1e9,!0),o=this.findIndex(n,1e9,!1,r);r<o;r++)if(s(this.from[r]+e,this.to[r]+e,this.value[r])===!1)return !1}map(e,t){let n=[],s=[],r=[],o=-1,l=-1;for(let u=0;u<this.value.length;u++){let a=this.value[u],h=this.from[u]+e,c=this.to[u]+e,f,d;if(h==c){let m=t.mapPos(h,a.startSide,a.mapMode);if(m==null||(f=d=m,a.startSide!=a.endSide&&(d=t.mapPos(h,a.endSide),d<f)))continue}else if(f=t.mapPos(h,a.startSide),d=t.mapPos(c,a.endSide),f>d||f==d&&a.startSide>0&&a.endSide<=0)continue;(d-f||a.endSide-a.startSide)<0||(o<0&&(o=f),a.point&&(l=Math.max(l,d-f)),n.push(a),s.push(f-o),r.push(d-o));}return {mapped:n.length?new i(s,r,n,l):null,pos:o}}},$=class i{constructor(e,t,n,s){this.chunkPos=e,this.chunk=t,this.nextLayer=n,this.maxPoint=s;}static create(e,t,n,s){return new i(e,t,n,s)}get length(){let e=this.chunk.length-1;return e<0?0:Math.max(this.chunkEnd(e),this.nextLayer.length)}get size(){if(this.isEmpty)return 0;let e=this.nextLayer.size;for(let t of this.chunk)e+=t.value.length;return e}chunkEnd(e){return this.chunkPos[e]+this.chunk[e].length}update(e){let{add:t=[],sort:n=!1,filterFrom:s=0,filterTo:r=this.length}=e,o=e.filter;if(t.length==0&&!o)return this;if(n&&(t=t.slice().sort(it)),this.isEmpty)return t.length?i.of(t):this;let l=new je(this,null,-1).goto(0),u=0,a=[],h=new Je;for(;l.value||u<t.length;)if(u<t.length&&(l.from-t[u].from||l.startSide-t[u].value.startSide)>=0){let c=t[u++];h.addInner(c.from,c.to,c.value)||a.push(c);}else l.rangeIndex==1&&l.chunkIndex<this.chunk.length&&(u==t.length||this.chunkEnd(l.chunkIndex)<t[u].from)&&(!o||s>this.chunkEnd(l.chunkIndex)||r<this.chunkPos[l.chunkIndex])&&h.addChunk(this.chunkPos[l.chunkIndex],this.chunk[l.chunkIndex])?l.nextChunk():((!o||s>l.to||r<l.from||o(l.from,l.to,l.value))&&(h.addInner(l.from,l.to,l.value)||a.push(be.create(l.from,l.to,l.value))),l.next());return h.finishInner(this.nextLayer.isEmpty&&!a.length?i.empty:this.nextLayer.update({add:a,filter:o,filterFrom:s,filterTo:r}))}map(e){if(e.empty||this.isEmpty)return this;let t=[],n=[],s=-1;for(let o=0;o<this.chunk.length;o++){let l=this.chunkPos[o],u=this.chunk[o],a=e.touchesRange(l,l+u.length);if(a===!1)s=Math.max(s,u.maxPoint),t.push(u),n.push(e.mapPos(l));else if(a===!0){let{mapped:h,pos:c}=u.map(l,e);h&&(s=Math.max(s,h.maxPoint),t.push(h),n.push(c));}}let r=this.nextLayer.map(e);return t.length==0?r:new i(n,t,r||i.empty,s)}between(e,t,n){if(!this.isEmpty){for(let s=0;s<this.chunk.length;s++){let r=this.chunkPos[s],o=this.chunk[s];if(t>=r&&e<=r+o.length&&o.between(r,e-r,t-r,n)===!1)return}this.nextLayer.between(e,t,n);}}iter(e=0){return Se.from([this]).goto(e)}get isEmpty(){return this.nextLayer==this}static iter(e,t=0){return Se.from(e).goto(t)}static compare(e,t,n,s,r=-1){let o=e.filter(c=>c.maxPoint>0||!c.isEmpty&&c.maxPoint>=r),l=t.filter(c=>c.maxPoint>0||!c.isEmpty&&c.maxPoint>=r),u=Ot(o,l,n),a=new X(o,u,r),h=new X(l,u,r);n.iterGaps((c,f,d)=>_t(a,c,h,f,d,s)),n.empty&&n.length==0&&_t(a,0,h,0,0,s);}static eq(e,t,n=0,s){s==null&&(s=1e9-1);let r=e.filter(h=>!h.isEmpty&&t.indexOf(h)<0),o=t.filter(h=>!h.isEmpty&&e.indexOf(h)<0);if(r.length!=o.length)return !1;if(!r.length)return !0;let l=Ot(r,o),u=new X(r,l,0).goto(n),a=new X(o,l,0).goto(n);for(;;){if(u.to!=a.to||!ot(u.active,a.active)||u.point&&(!a.point||!u.point.eq(a.point)))return !1;if(u.to>s)return !0;u.next(),a.next();}}static spans(e,t,n,s,r=-1){let o=new X(e,null,r).goto(t),l=t,u=o.openStart;for(;;){let a=Math.min(o.to,n);if(o.point){let h=o.activeForPoint(o.to),c=o.pointFrom<t?h.length+1:Math.min(h.length,u);s.point(l,a,o.point,h,c,o.pointRank),u=Math.min(o.openEnd(a),h.length);}else a>l&&(s.span(l,a,o.active,u),u=o.openEnd(a));if(o.to>n)return u+(o.point&&o.to>n?1:0);l=o.to,o.next();}}static of(e,t=!1){let n=new Je;for(let s of e instanceof be?[e]:t?Hn(e):e)n.add(s.from,s.to,s.value);return n.finish()}};$.empty=new $([],[],null,-1);function Hn(i){if(i.length>1)for(let e=i[0],t=1;t<i.length;t++){let n=i[t];if(it(e,n)>0)return i.slice().sort(it);e=n;}return i}$.empty.nextLayer=$.empty;var Je=class i{finishChunk(e){this.chunks.push(new st(this.from,this.to,this.value,this.maxPoint)),this.chunkPos.push(this.chunkStart),this.chunkStart=-1,this.setMaxPoint=Math.max(this.setMaxPoint,this.maxPoint),this.maxPoint=-1,e&&(this.from=[],this.to=[],this.value=[]);}constructor(){this.chunks=[],this.chunkPos=[],this.chunkStart=-1,this.last=null,this.lastFrom=-1e9,this.lastTo=-1e9,this.from=[],this.to=[],this.value=[],this.maxPoint=-1,this.setMaxPoint=-1,this.nextLayer=null;}add(e,t,n){this.addInner(e,t,n)||(this.nextLayer||(this.nextLayer=new i)).add(e,t,n);}addInner(e,t,n){let s=e-this.lastTo||n.startSide-this.last.endSide;if(s<=0&&(e-this.lastFrom||n.startSide-this.last.startSide)<0)throw new Error("Ranges must be added sorted by `from` position and `startSide`");return s<0?!1:(this.from.length==250&&this.finishChunk(!0),this.chunkStart<0&&(this.chunkStart=e),this.from.push(e-this.chunkStart),this.to.push(t-this.chunkStart),this.last=n,this.lastFrom=e,this.lastTo=t,this.value.push(n),n.point&&(this.maxPoint=Math.max(this.maxPoint,t-e)),!0)}addChunk(e,t){if((e-this.lastTo||t.value[0].startSide-this.last.endSide)<0)return !1;this.from.length&&this.finishChunk(!0),this.setMaxPoint=Math.max(this.setMaxPoint,t.maxPoint),this.chunks.push(t),this.chunkPos.push(e);let n=t.value.length-1;return this.last=t.value[n],this.lastFrom=t.from[n]+e,this.lastTo=t.to[n]+e,!0}finish(){return this.finishInner($.empty)}finishInner(e){if(this.from.length&&this.finishChunk(!1),this.chunks.length==0)return e;let t=$.create(this.chunkPos,this.chunks,this.nextLayer?this.nextLayer.finishInner(e):e,this.setMaxPoint);return this.from=null,t}};function Ot(i,e,t){let n=new Map;for(let r of i)for(let o=0;o<r.chunk.length;o++)r.chunk[o].maxPoint<=0&&n.set(r.chunk[o],r.chunkPos[o]);let s=new Set;for(let r of e)for(let o=0;o<r.chunk.length;o++){let l=n.get(r.chunk[o]);l!=null&&(t?t.mapPos(l):l)==r.chunkPos[o]&&!t?.touchesRange(l,l+r.chunk[o].length)&&s.add(r.chunk[o]);}return s}var je=class{constructor(e,t,n,s=0){this.layer=e,this.skip=t,this.minPoint=n,this.rank=s;}get startSide(){return this.value?this.value.startSide:0}get endSide(){return this.value?this.value.endSide:0}goto(e,t=-1e9){return this.chunkIndex=this.rangeIndex=0,this.gotoInner(e,t,!1),this}gotoInner(e,t,n){for(;this.chunkIndex<this.layer.chunk.length;){let s=this.layer.chunk[this.chunkIndex];if(!(this.skip&&this.skip.has(s)||this.layer.chunkEnd(this.chunkIndex)<e||s.maxPoint<this.minPoint))break;this.chunkIndex++,n=!1;}if(this.chunkIndex<this.layer.chunk.length){let s=this.layer.chunk[this.chunkIndex].findIndex(e-this.layer.chunkPos[this.chunkIndex],t,!0);(!n||this.rangeIndex<s)&&this.setRangeIndex(s);}this.next();}forward(e,t){(this.to-e||this.endSide-t)<0&&this.gotoInner(e,t,!0);}next(){for(;;)if(this.chunkIndex==this.layer.chunk.length){this.from=this.to=1e9,this.value=null;break}else {let e=this.layer.chunkPos[this.chunkIndex],t=this.layer.chunk[this.chunkIndex],n=e+t.from[this.rangeIndex];if(this.from=n,this.to=e+t.to[this.rangeIndex],this.value=t.value[this.rangeIndex],this.setRangeIndex(this.rangeIndex+1),this.minPoint<0||this.value.point&&this.to-this.from>=this.minPoint)break}}setRangeIndex(e){if(e==this.layer.chunk[this.chunkIndex].value.length){if(this.chunkIndex++,this.skip)for(;this.chunkIndex<this.layer.chunk.length&&this.skip.has(this.layer.chunk[this.chunkIndex]);)this.chunkIndex++;this.rangeIndex=0;}else this.rangeIndex=e;}nextChunk(){this.chunkIndex++,this.rangeIndex=0,this.next();}compare(e){return this.from-e.from||this.startSide-e.startSide||this.rank-e.rank||this.to-e.to||this.endSide-e.endSide}},Se=class i{constructor(e){this.heap=e;}static from(e,t=null,n=-1){let s=[];for(let r=0;r<e.length;r++)for(let o=e[r];!o.isEmpty;o=o.nextLayer)o.maxPoint>=n&&s.push(new je(o,t,n,r));return s.length==1?s[0]:new i(s)}get startSide(){return this.value?this.value.startSide:0}goto(e,t=-1e9){for(let n of this.heap)n.goto(e,t);for(let n=this.heap.length>>1;n>=0;n--)Ge(this.heap,n);return this.next(),this}forward(e,t){for(let n of this.heap)n.forward(e,t);for(let n=this.heap.length>>1;n>=0;n--)Ge(this.heap,n);(this.to-e||this.value.endSide-t)<0&&this.next();}next(){if(this.heap.length==0)this.from=this.to=1e9,this.value=null,this.rank=-1;else {let e=this.heap[0];this.from=e.from,this.to=e.to,this.value=e.value,this.rank=e.rank,e.value&&e.next(),Ge(this.heap,0);}}};function Ge(i,e){for(let t=i[e];;){let n=(e<<1)+1;if(n>=i.length)break;let s=i[n];if(n+1<i.length&&s.compare(i[n+1])>=0&&(s=i[n+1],n++),t.compare(s)<0)break;i[n]=t,i[e]=s,e=n;}}var X=class{constructor(e,t,n){this.minPoint=n,this.active=[],this.activeTo=[],this.activeRank=[],this.minActive=-1,this.point=null,this.pointFrom=0,this.pointRank=0,this.to=-1e9,this.endSide=0,this.openStart=-1,this.cursor=Se.from(e,t,n);}goto(e,t=-1e9){return this.cursor.goto(e,t),this.active.length=this.activeTo.length=this.activeRank.length=0,this.minActive=-1,this.to=e,this.endSide=t,this.openStart=-1,this.next(),this}forward(e,t){for(;this.minActive>-1&&(this.activeTo[this.minActive]-e||this.active[this.minActive].endSide-t)<0;)this.removeActive(this.minActive);this.cursor.forward(e,t);}removeActive(e){Te(this.active,e),Te(this.activeTo,e),Te(this.activeRank,e),this.minActive=Nt(this.active,this.activeTo);}addActive(e){let t=0,{value:n,to:s,rank:r}=this.cursor;for(;t<this.activeRank.length&&this.activeRank[t]<=r;)t++;Ce(this.active,t,n),Ce(this.activeTo,t,s),Ce(this.activeRank,t,r),e&&Ce(e,t,this.cursor.from),this.minActive=Nt(this.active,this.activeTo);}next(){let e=this.to,t=this.point;this.point=null;let n=this.openStart<0?[]:null;for(;;){let s=this.minActive;if(s>-1&&(this.activeTo[s]-this.cursor.from||this.active[s].endSide-this.cursor.startSide)<0){if(this.activeTo[s]>e){this.to=this.activeTo[s],this.endSide=this.active[s].endSide;break}this.removeActive(s),n&&Te(n,s);}else if(this.cursor.value)if(this.cursor.from>e){this.to=this.cursor.from,this.endSide=this.cursor.startSide;break}else {let r=this.cursor.value;if(!r.point)this.addActive(n),this.cursor.next();else if(t&&this.cursor.to==this.to&&this.cursor.from<this.cursor.to)this.cursor.next();else {this.point=r,this.pointFrom=this.cursor.from,this.pointRank=this.cursor.rank,this.to=this.cursor.to,this.endSide=r.endSide,this.cursor.next(),this.forward(this.to,this.endSide);break}}else {this.to=this.endSide=1e9;break}}if(n){this.openStart=0;for(let s=n.length-1;s>=0&&n[s]<e;s--)this.openStart++;}}activeForPoint(e){if(!this.active.length)return this.active;let t=[];for(let n=this.active.length-1;n>=0&&!(this.activeRank[n]<this.pointRank);n--)(this.activeTo[n]>e||this.activeTo[n]==e&&this.active[n].endSide>=this.point.endSide)&&t.push(this.active[n]);return t.reverse()}openEnd(e){let t=0;for(let n=this.activeTo.length-1;n>=0&&this.activeTo[n]>e;n--)t++;return t}};function _t(i,e,t,n,s,r){i.goto(e),t.goto(n);let o=n+s,l=n,u=n-e;for(;;){let a=i.to+u-t.to||i.endSide-t.endSide,h=a<0?i.to+u:t.to,c=Math.min(h,o);if(i.point||t.point?i.point&&t.point&&(i.point==t.point||i.point.eq(t.point))&&ot(i.activeForPoint(i.to),t.activeForPoint(t.to))||r.comparePoint(l,c,i.point,t.point):c>l&&!ot(i.active,t.active)&&r.compareRange(l,c,i.active,t.active),h>o)break;l=h,a<=0&&i.next(),a>=0&&t.next();}}function ot(i,e){if(i.length!=e.length)return !1;for(let t=0;t<i.length;t++)if(i[t]!=e[t]&&!i[t].eq(e[t]))return !1;return !0}function Te(i,e){for(let t=e,n=i.length-1;t<n;t++)i[t]=i[t+1];i.pop();}function Ce(i,e,t){for(let n=i.length-1;n>=e;n--)i[n+1]=i[n];i[e]=t;}function Nt(i,e){let t=-1,n=1e9;for(let s=0;s<e.length;s++)(e[s]-n||i[s].endSide-i[t].endSide)<0&&(t=s,n=e[s]);return t}var Pe=e(In()),Ue=e(a()),gt=1e4;Object.fromEntries(Object.entries(Ue.CompletionItemKind).map(([i,e])=>[e,i]));var mt=i=>i.reduce((e,t)=>t,"");x.define({combine:mt});x.define({combine:mt});x.define({combine:mt});var We=class{constructor(e){this.rootUri=e.rootUri,this.workspaceFolders=e.workspaceFolders,this.autoClose=e.autoClose,this.plugins=[],this.transport=e.transport,this.requestManager=new Pe.RequestManager([this.transport]),this.client=new Pe.Client(this.requestManager),this.client.onNotification(n=>{this.processNotification(n);});let t=this.transport;t&&t.connection&&t.connection.addEventListener("message",n=>{let s=JSON.parse(n.data);s.method&&s.id&&t.connection.send(JSON.stringify({jsonrpc:"2.0",id:s.id,result:null}));}),this.initializePromise=this.initialize();}async initialize(){let{capabilities:e}=await this.request("initialize",{capabilities:{textDocument:{hover:{dynamicRegistration:!0,contentFormat:["plaintext","markdown"]},moniker:{},synchronization:{dynamicRegistration:!0,willSave:!1,didSave:!1,willSaveWaitUntil:!1},completion:{dynamicRegistration:!0,completionItem:{snippetSupport:!1,commitCharactersSupport:!0,documentationFormat:["plaintext","markdown"],deprecatedSupport:!1,preselectSupport:!1},contextSupport:!1},signatureHelp:{dynamicRegistration:!0,signatureInformation:{documentationFormat:["plaintext","markdown"]}},declaration:{dynamicRegistration:!0,linkSupport:!0},definition:{dynamicRegistration:!0,linkSupport:!0},typeDefinition:{dynamicRegistration:!0,linkSupport:!0},implementation:{dynamicRegistration:!0,linkSupport:!0}},workspace:{didChangeConfiguration:{dynamicRegistration:!0}}},initializationOptions:null,processId:null,rootUri:this.rootUri,workspaceFolders:this.workspaceFolders},gt*3);this.capabilities=e,this.notify("initialized",{}),this.ready=!0;}close(){this.client.close();}textDocumentDidOpen(e){return this.notify("textDocument/didOpen",e)}textDocumentDidChange(e){return this.notify("textDocument/didChange",e)}async textDocumentHover(e){return await this.request("textDocument/hover",e,gt)}async textDocumentCompletion(e){return await this.request("textDocument/completion",e,gt)}attachPlugin(e){this.plugins.push(e);}detachPlugin(e){let t=this.plugins.indexOf(e);t!==-1&&(this.plugins.splice(t,1),this.autoClose&&this.close());}request(e,t,n){return this.client.request({method:e,params:t},n)}notify(e,t){return this.client.notify({method:e,params:t})}processNotification(e){for(let t of this.plugins)t.processNotification(e);}};var vt=class extends ve{constructor(t,n){let s;switch(typeof t){case"string":s=new Worker(t);break;default:{if(t instanceof Worker){s=t;break}if(t instanceof URL){s=new Worker(t);break}throw new Error(`Invalid worker type. Expected string, URL, or Worker. Received ${typeof t}`)}}super(s);this.options=n;this.internalMessageId=0;this.rpcQueue=new Map;this.client=()=>(this.langClient||(this.langClient=new We({transport:this,...this.options})),this.langClient);this.onMessage=this.onMessage.bind(this),this.worker.addEventListener("message",this.onMessage),this.worker.onerror=r=>{console.error(r);},this.worker.onmessageerror=r=>{console.error(r);};}dispose(){this.worker.removeEventListener("message",this.onMessage),this.worker.terminate(),this.rpcQueue.clear(),this.rpcQueue=null,this.worker=null,this.langClient.close(),this.langClient=null,this.internalMessageId=null,this.options=null;}sendNotification(t,n){this.langClient.notify(t,n);}addFiles(t,n){if(typeof t=="object")return this.sendAddFiles(t);if(typeof t=="string"&&typeof n=="string")return this.sendAddFiles({[t]:n});throw new Error("Invalid arguments")}fetchTypes(t){return this.sendFetchTypes(t)}setup(t,n){if(typeof t=="object")return this.sendSetup(t);if(typeof t=="string"&&typeof n=="string")return this.sendSetup({[t]:n});throw new Error("Invalid arguments")}deleteFile(t){return this.sendDeleteFile(t)}sendDeleteFile(t){return new Promise((n,s)=>{let r=this.internalMessageId++;this.rpcQueue.set(r,n),this.worker.postMessage({id:r,method:"@@delete-file",params:{fileName:t}});})}onMessage(t){let n=t.data;if(!(n&&typeof n=="object"&&"jsonrpc"in n)&&n&&typeof n=="object"&&"method"in n&&"complete"in n){let s=n.method;switch(s){case"@@setup":case"@@add-files":case"@@fetch-types":this.rpcQueue.get(n.id)?.(n.complete),this.rpcQueue.delete(n.id);return;default:throw new Error(`Unknown RPC method ${s}`)}}}sendAddFiles(t){return new Promise((s,r)=>{let o=this.internalMessageId++;this.rpcQueue.set(o,s),this.worker.postMessage({params:t,id:o,method:"@@add-files"});})}sendFetchTypes(t){return new Promise((n,s)=>{let r=this.internalMessageId++;this.rpcQueue.set(r,n),this.worker.postMessage({id:r,method:"@@fetch-types",params:t});})}async sendSetup(t){return new Promise((s,r)=>{let o=this.internalMessageId++;this.rpcQueue.set(o,s),this.worker.postMessage({params:t,id:o,method:"@@setup"});}).then(s=>this.client())}};

export { vt as WorkerRPC };
//# sourceMappingURL=out.js.map
//# sourceMappingURL=index.js.map