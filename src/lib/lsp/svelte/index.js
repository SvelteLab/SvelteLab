import { a } from './chunk-2ZHY67WV.js';
export { b as createWorkerMessage, a as workerRPCMethods } from './chunk-SUQRZR4A.js';
import { c, j as j$1, h, o, f, n, d, b as b$1, e, m as m$1 } from './chunk-V5V6QK5E.js';
import { Facet } from '@codemirror/state';

new URL(import.meta.url).pathname; 
var ye=c(S=>{j$1();h();var de=S&&S.__awaiter||function(i,t,e,n){function s(r){return r instanceof e?r:new e(function(a){a(r);})}return new(e||(e=Promise))(function(r,a){function c(u){try{o(n.next(u));}catch(p){a(p);}}function h(u){try{o(n.throw(u));}catch(p){a(p);}}function o(u){u.done?r(u.value):s(u.value).then(c,h);}o((n=n.apply(i,t||[])).next());})},ve=S&&S.__generator||function(i,t){var e={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},n,s,r,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(o){return function(u){return h([o,u])}}function h(o){if(n)throw new TypeError("Generator is already executing.");for(;e;)try{if(n=1,s&&(r=o[0]&2?s.return:o[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,o[1])).done)return r;switch(s=0,r&&(o=[o[0]&2,r.value]),o[0]){case 0:case 1:r=o;break;case 4:return e.label++,{value:o[1],done:!1};case 5:e.label++,s=o[1],o=[0];continue;case 7:o=e.ops.pop(),e.trys.pop();continue;default:if(r=e.trys,!(r=r.length>0&&r[r.length-1])&&(o[0]===6||o[0]===2)){e=0;continue}if(o[0]===3&&(!r||o[1]>r[0]&&o[1]<r[3])){e.label=o[1];break}if(o[0]===6&&e.label<r[1]){e.label=r[1],r=o;break}if(r&&e.label<r[2]){e.label=r[2],e.ops.push(o);break}r[2]&&e.ops.pop(),e.trys.pop();continue}o=t.call(i,e);}catch(u){o=[6,u],s=0;}finally{n=r=0;}if(o[0]&5)throw o[1];return {value:o[0]?o[1]:void 0,done:!0}}};Object.defineProperty(S,"__esModule",{value:!0});S.defaultNextRequest=void 0;var Xe=(o(),f(n));S.defaultNextRequest=function(){var i=-1;return function(){return ++i}};var Ze=function(){function i(t,e){e===void 0&&(e=S.defaultNextRequest()),this.batch=[],this.batchStarted=!1,this.lastId=-1,this.transports=t,this.requests={},this.connectPromise=this.connect(),this.requestChannel=new Xe.EventEmitter,this.nextID=e;}return i.prototype.connect=function(){var t=this;return Promise.all(this.transports.map(function(e){return de(t,void 0,void 0,function(){return ve(this,function(n){switch(n.label){case 0:return e.subscribe("error",this.handleError.bind(this)),e.subscribe("notification",this.handleNotification.bind(this)),[4,e.connect()];case 1:return n.sent(),[2]}})})}))},i.prototype.getPrimaryTransport=function(){return this.transports[0]},i.prototype.request=function(t,e,n){return e===void 0&&(e=!1),de(this,void 0,void 0,function(){var s,r,a,c,h=this;return ve(this,function(o){return s=this.nextID().toString(),r=e?null:s,a={request:this.makeRequest(t.method,t.params||[],r),internalID:s},this.batchStarted?(c=new Promise(function(u,p){h.batch.push({resolve:u,reject:p,request:a});}),[2,c]):[2,this.getPrimaryTransport().sendData(a,n)]})})},i.prototype.close=function(){this.requestChannel.removeAllListeners(),this.transports.forEach(function(t){t.unsubscribe(),t.close();});},i.prototype.startBatch=function(){this.batchStarted=!0;},i.prototype.stopBatch=function(){if(this.batchStarted===!1)throw new Error("cannot end that which has never started");if(this.batch.length===0){this.batchStarted=!1;return}this.getPrimaryTransport().sendData(this.batch),this.batch=[],this.batchStarted=!1;},i.prototype.makeRequest=function(t,e,n){return n?{jsonrpc:"2.0",id:n,method:t,params:e}:{jsonrpc:"2.0",method:t,params:e}},i.prototype.handleError=function(t){this.requestChannel.emit("error",t);},i.prototype.handleNotification=function(t){this.requestChannel.emit("notification",t);},i}();S.default=Ze;});var k=c(R=>{j$1();h();var Ye=R&&R.__extends||function(){var i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s;}||function(n,s){for(var r in s)s.hasOwnProperty(r)&&(n[r]=s[r]);},i(t,e)};return function(t,e){i(t,e);function n(){this.constructor=t;}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n);}}();Object.defineProperty(R,"__esModule",{value:!0});R.convertJSONToRPCError=R.JSONRPCError=R.ERR_UNKNOWN=R.ERR_MISSIING_ID=R.ERR_TIMEOUT=void 0;R.ERR_TIMEOUT=7777;R.ERR_MISSIING_ID=7878;R.ERR_UNKNOWN=7979;var Y=function(i){Ye(t,i);function t(e,n,s){var r=this.constructor,a=i.call(this,e)||this;return a.message=e,a.code=n,a.data=s,Object.setPrototypeOf(a,r.prototype),a}return t}(Error);R.JSONRPCError=Y;R.convertJSONToRPCError=function(i){if(i.error){var t=i.error,e=t.message,n=t.code,s=t.data;return new Y(e,n,s)}return new Y("Unknown error",R.ERR_UNKNOWN,i)};});var me=c(G=>{j$1();h();Object.defineProperty(G,"__esModule",{value:!0});G.TransportRequestManager=void 0;var et=(o(),f(n)),J=k(),tt=function(){function i(){this.pendingRequest={},this.pendingBatchRequest={},this.transportEventChannel=new et.EventEmitter;}return i.prototype.addRequest=function(t,e){return this.transportEventChannel.emit("pending",t),t instanceof Array?(this.addBatchReq(t,e),Promise.resolve()):this.addReq(t.internalID,e)},i.prototype.settlePendingRequest=function(t,e){var n=this;t.forEach(function(s){var r=n.pendingRequest[s.internalID];if(delete n.pendingBatchRequest[s.internalID],r!==void 0){if(e){r.reject(e);return}r.resolve(),(s.request.id===null||s.request.id===void 0)&&delete n.pendingRequest[s.internalID];}});},i.prototype.isPendingRequest=function(t){return this.pendingRequest.hasOwnProperty(t)},i.prototype.resolveResponse=function(t,e){e===void 0&&(e=!0);var n=t;try{return n=JSON.parse(t),this.checkJSONRPC(n)===!1?void 0:n instanceof Array?this.resolveBatch(n,e):this.resolveRes(n,e)}catch{var s=new J.JSONRPCError("Bad response format",J.ERR_UNKNOWN,t);return e&&this.transportEventChannel.emit("error",s),s}},i.prototype.addBatchReq=function(t,e){var n=this;return t.forEach(function(s){var r=s.resolve,a=s.reject,c=s.request.internalID;n.pendingBatchRequest[c]=!0,n.pendingRequest[c]={resolve:r,reject:a};}),Promise.resolve()},i.prototype.addReq=function(t,e){var n=this;return new Promise(function(s,r){e!==null&&e&&n.setRequestTimeout(t,e,r),n.pendingRequest[t]={resolve:s,reject:r};})},i.prototype.checkJSONRPC=function(t){var e=[t];return t instanceof Array&&(e=t),e.every(function(n){return n.result!==void 0||n.error!==void 0||n.method!==void 0})},i.prototype.processResult=function(t,e){if(t.error){var n=J.convertJSONToRPCError(t);e.reject(n);return}e.resolve(t.result);},i.prototype.resolveBatch=function(t,e){var n=this,s=t.map(function(a){return n.resolveRes(a,e)}),r=s.filter(function(a){return a});if(r.length>0)return r[0]},i.prototype.resolveRes=function(t,e){var n=t.id,s=t.error,r=this.pendingRequest[n];if(r){delete this.pendingRequest[n],this.processResult(t,r),this.transportEventChannel.emit("response",t);return}if(n===void 0&&s===void 0){this.transportEventChannel.emit("notification",t);return}var a;return s&&(a=J.convertJSONToRPCError(t)),e&&s&&a&&this.transportEventChannel.emit("error",a),a},i.prototype.setRequestTimeout=function(t,e,n){var s=this;setTimeout(function(){delete s.pendingRequest[t],n(new J.JSONRPCError("Request timeout request took longer than "+e+" ms to resolve",J.ERR_TIMEOUT));},e);},i}();G.TransportRequestManager=tt;});var j=c(K=>{j$1();h();Object.defineProperty(K,"__esModule",{value:!0});K.Transport=void 0;var rt=me(),nt=function(){function i(){this.transportRequestManager=new rt.TransportRequestManager,this.transportRequestManager.transportEventChannel.on("error",function(){});}return i.prototype.subscribe=function(t,e){this.transportRequestManager.transportEventChannel.addListener(t,e);},i.prototype.unsubscribe=function(t,e){if(!t)return this.transportRequestManager.transportEventChannel.removeAllListeners();t&&e&&this.transportRequestManager.transportEventChannel.removeListener(t,e);},i.prototype.parseData=function(t){return t instanceof Array?t.map(function(e){return e.request.request}):t.request},i}();K.Transport=nt;});var B=c(E=>{j$1();h();Object.defineProperty(E,"__esModule",{value:!0});E.getNotifications=E.getBatchRequests=E.isNotification=void 0;E.isNotification=function(i){return i.request.id===void 0||i.request.id===null};E.getBatchRequests=function(i){return i instanceof Array?i.filter(function(t){var e=t.request.request.id;return e!=null}).map(function(t){return t.request}):[]};E.getNotifications=function(i){return i instanceof Array?i.filter(function(t){return E.isNotification(t.request)}).map(function(t){return t.request}):E.isNotification(i)?[i]:[]};});var Re=c(W=>{j$1();h();var it=W&&W.__extends||function(){var i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s;}||function(n,s){for(var r in s)s.hasOwnProperty(r)&&(n[r]=s[r]);},i(t,e)};return function(t,e){i(t,e);function n(){this.constructor=t;}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n);}}();Object.defineProperty(W,"__esModule",{value:!0});var st=j(),ot=B(),ge=k(),at=function(i){it(t,i);function t(e,n,s){var r=i.call(this)||this;return r.connection=e,r.reqUri=n,r.resUri=s,r}return t.prototype.connect=function(){var e=this;return this.connection.on(this.resUri,function(n){e.transportRequestManager.resolveResponse(n);}),Promise.resolve()},t.prototype.sendData=function(e,n){n===void 0&&(n=null);var s=this.transportRequestManager.addRequest(e,n),r=ot.getNotifications(e),a=this.parseData(e);try{return this.connection.emit(this.reqUri,a),this.transportRequestManager.settlePendingRequest(r),s}catch(h){var c=new ge.JSONRPCError(h.message,ge.ERR_UNKNOWN,h);return this.transportRequestManager.settlePendingRequest(r,c),Promise.reject(c)}},t.prototype.close=function(){this.connection.removeAllListeners();},t}(st.Transport);W.default=at;});var Se={};d(Se,{DOMException:()=>O,Headers:()=>m,Request:()=>N,Response:()=>_,fetch:()=>ne});function ut(i){return i&&DataView.prototype.isPrototypeOf(i)}function A(i){if(typeof i!="string"&&(i=String(i)),/[^a-z0-9\-#$%&'*+.^_`|~!]/i.test(i)||i==="")throw new TypeError('Invalid character in header field name: "'+i+'"');return i.toLowerCase()}function te(i){return typeof i!="string"&&(i=String(i)),i}function re(i){var t={next:function(){var e=i.shift();return {done:e===void 0,value:e}}};return b.iterable&&(t[Symbol.iterator]=function(){return t}),t}function m(i){this.map={},i instanceof m?i.forEach(function(t,e){this.append(e,t);},this):Array.isArray(i)?i.forEach(function(t){if(t.length!=2)throw new TypeError("Headers constructor: expected name/value pair to be length 2, found"+t.length);this.append(t[0],t[1]);},this):i&&Object.getOwnPropertyNames(i).forEach(function(t){this.append(t,i[t]);},this);}function ee(i){if(!i._noBody){if(i.bodyUsed)return Promise.reject(new TypeError("Already read"));i.bodyUsed=!0;}}function _e(i){return new Promise(function(t,e){i.onload=function(){t(i.result);},i.onerror=function(){e(i.error);};})}function ct(i){var t=new FileReader,e=_e(t);return t.readAsArrayBuffer(i),e}function lt(i){var t=new FileReader,e=_e(t),n=/charset=([A-Za-z0-9_-]+)/.exec(i.type),s=n?n[1]:"utf-8";return t.readAsText(i,s),e}function ft(i){for(var t=new Uint8Array(i),e=new Array(t.length),n=0;n<t.length;n++)e[n]=String.fromCharCode(t[n]);return e.join("")}function we(i){if(i.slice)return i.slice(0);var t=new Uint8Array(i.byteLength);return t.set(new Uint8Array(i)),t.buffer}function Pe(){return this.bodyUsed=!1,this._initBody=function(i){this.bodyUsed=this.bodyUsed,this._bodyInit=i,i?typeof i=="string"?this._bodyText=i:b.blob&&Blob.prototype.isPrototypeOf(i)?this._bodyBlob=i:b.formData&&FormData.prototype.isPrototypeOf(i)?this._bodyFormData=i:b.searchParams&&URLSearchParams.prototype.isPrototypeOf(i)?this._bodyText=i.toString():b.arrayBuffer&&b.blob&&ut(i)?(this._bodyArrayBuffer=we(i.buffer),this._bodyInit=new Blob([this._bodyArrayBuffer])):b.arrayBuffer&&(ArrayBuffer.prototype.isPrototypeOf(i)||qe(i))?this._bodyArrayBuffer=we(i):this._bodyText=i=Object.prototype.toString.call(i):(this._noBody=!0,this._bodyText=""),this.headers.get("content-type")||(typeof i=="string"?this.headers.set("content-type","text/plain;charset=UTF-8"):this._bodyBlob&&this._bodyBlob.type?this.headers.set("content-type",this._bodyBlob.type):b.searchParams&&URLSearchParams.prototype.isPrototypeOf(i)&&this.headers.set("content-type","application/x-www-form-urlencoded;charset=UTF-8"));},b.blob&&(this.blob=function(){var i=ee(this);if(i)return i;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(new Blob([this._bodyArrayBuffer]));if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))}),this.arrayBuffer=function(){if(this._bodyArrayBuffer){var i=ee(this);return i||(ArrayBuffer.isView(this._bodyArrayBuffer)?Promise.resolve(this._bodyArrayBuffer.buffer.slice(this._bodyArrayBuffer.byteOffset,this._bodyArrayBuffer.byteOffset+this._bodyArrayBuffer.byteLength)):Promise.resolve(this._bodyArrayBuffer))}else {if(b.blob)return this.blob().then(ct);throw new Error("could not read as ArrayBuffer")}},this.text=function(){var i=ee(this);if(i)return i;if(this._bodyBlob)return lt(this._bodyBlob);if(this._bodyArrayBuffer)return Promise.resolve(ft(this._bodyArrayBuffer));if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)},b.formData&&(this.formData=function(){return this.text().then(dt)}),this.json=function(){return this.text().then(JSON.parse)},this}function pt(i){var t=i.toUpperCase();return ht.indexOf(t)>-1?t:i}function N(i,t){if(!(this instanceof N))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');t=t||{};var e=t.body;if(i instanceof N){if(i.bodyUsed)throw new TypeError("Already read");this.url=i.url,this.credentials=i.credentials,t.headers||(this.headers=new m(i.headers)),this.method=i.method,this.mode=i.mode,this.signal=i.signal,!e&&i._bodyInit!=null&&(e=i._bodyInit,i.bodyUsed=!0);}else this.url=String(i);if(this.credentials=t.credentials||this.credentials||"same-origin",(t.headers||!this.headers)&&(this.headers=new m(t.headers)),this.method=pt(t.method||this.method||"GET"),this.mode=t.mode||this.mode||null,this.signal=t.signal||this.signal||function(){if("AbortController"in g){var r=new AbortController;return r.signal}}(),this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&e)throw new TypeError("Body not allowed for GET or HEAD requests");if(this._initBody(e),(this.method==="GET"||this.method==="HEAD")&&(t.cache==="no-store"||t.cache==="no-cache")){var n=/([?&])_=[^&]*/;if(n.test(this.url))this.url=this.url.replace(n,"$1_="+new Date().getTime());else {var s=/\?/;this.url+=(s.test(this.url)?"&":"?")+"_="+new Date().getTime();}}}function dt(i){var t=new FormData;return i.trim().split("&").forEach(function(e){if(e){var n=e.split("="),s=n.shift().replace(/\+/g," "),r=n.join("=").replace(/\+/g," ");t.append(decodeURIComponent(s),decodeURIComponent(r));}}),t}function vt(i){var t=new m,e=i.replace(/\r?\n[\t ]+/g," ");return e.split("\r").map(function(n){return n.indexOf(`
`)===0?n.substr(1,n.length):n}).forEach(function(n){var s=n.split(":"),r=s.shift().trim();if(r){var a=s.join(":").trim();try{t.append(r,a);}catch(c){console.warn("Response "+c.message);}}}),t}function _(i,t){if(!(this instanceof _))throw new TypeError('Please use the "new" operator, this DOM object constructor cannot be called as a function.');if(t||(t={}),this.type="default",this.status=t.status===void 0?200:t.status,this.status<200||this.status>599)throw new RangeError("Failed to construct 'Response': The status provided (0) is outside the range [200, 599].");this.ok=this.status>=200&&this.status<300,this.statusText=t.statusText===void 0?"":""+t.statusText,this.headers=new m(t.headers),this.url=t.url||"",this._initBody(i);}function ne(i,t){return new Promise(function(e,n){var s=new N(i,t);if(s.signal&&s.signal.aborted)return n(new O("Aborted","AbortError"));var r=new XMLHttpRequest;function a(){r.abort();}r.onload=function(){var o={statusText:r.statusText,headers:vt(r.getAllResponseHeaders()||"")};s.url.startsWith("file://")&&(r.status<200||r.status>599)?o.status=200:o.status=r.status,o.url="responseURL"in r?r.responseURL:o.headers.get("X-Request-URL");var u="response"in r?r.response:r.responseText;setTimeout(function(){e(new _(u,o));},0);},r.onerror=function(){setTimeout(function(){n(new TypeError("Network request failed"));},0);},r.ontimeout=function(){setTimeout(function(){n(new TypeError("Network request timed out"));},0);},r.onabort=function(){setTimeout(function(){n(new O("Aborted","AbortError"));},0);};function c(o){try{return o===""&&g.location.href?g.location.href:o}catch{return o}}if(r.open(s.method,c(s.url),!0),s.credentials==="include"?r.withCredentials=!0:s.credentials==="omit"&&(r.withCredentials=!1),"responseType"in r&&(b.blob?r.responseType="blob":b.arrayBuffer&&(r.responseType="arraybuffer")),t&&typeof t.headers=="object"&&!(t.headers instanceof m||g.Headers&&t.headers instanceof g.Headers)){var h=[];Object.getOwnPropertyNames(t.headers).forEach(function(o){h.push(A(o)),r.setRequestHeader(o,te(t.headers[o]));}),s.headers.forEach(function(o,u){h.indexOf(u)===-1&&r.setRequestHeader(u,o);});}else s.headers.forEach(function(o,u){r.setRequestHeader(u,o);});s.signal&&(s.signal.addEventListener("abort",a),r.onreadystatechange=function(){r.readyState===4&&s.signal.removeEventListener("abort",a);}),r.send(typeof s._bodyInit>"u"?null:s._bodyInit);})}var g,b,be,qe,ht,yt,O,Ee=b$1(()=>{j$1();h();g=typeof globalThis<"u"&&globalThis||typeof self<"u"&&self||typeof globalThis<"u"&&globalThis||{},b={searchParams:"URLSearchParams"in g,iterable:"Symbol"in g&&"iterator"in Symbol,blob:"FileReader"in g&&"Blob"in g&&function(){try{return new Blob,!0}catch{return !1}}(),formData:"FormData"in g,arrayBuffer:"ArrayBuffer"in g};b.arrayBuffer&&(be=["[object Int8Array]","[object Uint8Array]","[object Uint8ClampedArray]","[object Int16Array]","[object Uint16Array]","[object Int32Array]","[object Uint32Array]","[object Float32Array]","[object Float64Array]"],qe=ArrayBuffer.isView||function(i){return i&&be.indexOf(Object.prototype.toString.call(i))>-1});m.prototype.append=function(i,t){i=A(i),t=te(t);var e=this.map[i];this.map[i]=e?e+", "+t:t;};m.prototype.delete=function(i){delete this.map[A(i)];};m.prototype.get=function(i){return i=A(i),this.has(i)?this.map[i]:null};m.prototype.has=function(i){return this.map.hasOwnProperty(A(i))};m.prototype.set=function(i,t){this.map[A(i)]=te(t);};m.prototype.forEach=function(i,t){for(var e in this.map)this.map.hasOwnProperty(e)&&i.call(t,this.map[e],e,this);};m.prototype.keys=function(){var i=[];return this.forEach(function(t,e){i.push(e);}),re(i)};m.prototype.values=function(){var i=[];return this.forEach(function(t){i.push(t);}),re(i)};m.prototype.entries=function(){var i=[];return this.forEach(function(t,e){i.push([e,t]);}),re(i)};b.iterable&&(m.prototype[Symbol.iterator]=m.prototype.entries);ht=["CONNECT","DELETE","GET","HEAD","OPTIONS","PATCH","POST","PUT","TRACE"];N.prototype.clone=function(){return new N(this,{body:this._bodyInit})};Pe.call(N.prototype);Pe.call(_.prototype);_.prototype.clone=function(){return new _(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new m(this.headers),url:this.url})};_.error=function(){var i=new _(null,{status:200,statusText:""});return i.status=0,i.type="error",i};yt=[301,302,303,307,308];_.redirect=function(i,t){if(yt.indexOf(t)===-1)throw new RangeError("Invalid status code");return new _(null,{status:t,headers:{location:i}})};O=g.DOMException;try{new O;}catch{O=function(t,e){this.message=t,this.name=e;var n=Error(t);this.stack=n.stack;},O.prototype=Object.create(Error.prototype),O.prototype.constructor=O;}ne.polyfill=!0;g.fetch||(g.fetch=ne,g.Headers=m,g.Request=N,g.Response=_);});var Te=c((gr,Ce)=>{j$1();h();Ee();Ce.exports=self.fetch.bind(self);});var Ie=c(q=>{j$1();h();var mt=q&&q.__extends||function(){var i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s;}||function(n,s){for(var r in s)s.hasOwnProperty(r)&&(n[r]=s[r]);},i(t,e)};return function(t,e){i(t,e);function n(){this.constructor=t;}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n);}}(),gt=q&&q.__awaiter||function(i,t,e,n){function s(r){return r instanceof e?r:new e(function(a){a(r);})}return new(e||(e=Promise))(function(r,a){function c(u){try{o(n.next(u));}catch(p){a(p);}}function h(u){try{o(n.throw(u));}catch(p){a(p);}}function o(u){u.done?r(u.value):s(u.value).then(c,h);}o((n=n.apply(i,t||[])).next());})},Rt=q&&q.__generator||function(i,t){var e={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},n,s,r,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(o){return function(u){return h([o,u])}}function h(o){if(n)throw new TypeError("Generator is already executing.");for(;e;)try{if(n=1,s&&(r=o[0]&2?s.return:o[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,o[1])).done)return r;switch(s=0,r&&(o=[o[0]&2,r.value]),o[0]){case 0:case 1:r=o;break;case 4:return e.label++,{value:o[1],done:!1};case 5:e.label++,s=o[1],o=[0];continue;case 7:o=e.ops.pop(),e.trys.pop();continue;default:if(r=e.trys,!(r=r.length>0&&r[r.length-1])&&(o[0]===6||o[0]===2)){e=0;continue}if(o[0]===3&&(!r||o[1]>r[0]&&o[1]<r[3])){e.label=o[1];break}if(o[0]===6&&e.label<r[1]){e.label=r[1],r=o;break}if(r&&e.label<r[2]){e.label=r[2],e.ops.push(o);break}r[2]&&e.ops.pop(),e.trys.pop();continue}o=t.call(i,e);}catch(u){o=[6,u],s=0;}finally{n=r=0;}if(o[0]&5)throw o[1];return {value:o[0]?o[1]:void 0,done:!0}}},bt=q&&q.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(q,"__esModule",{value:!0});q.HTTPTransport=void 0;var wt=bt(Te()),qt=j(),ie=B(),Oe=k(),Ne=function(i){mt(t,i);function t(e,n){var s=i.call(this)||this;return s.onlyNotifications=function(r){return r instanceof Array?r.every(function(a){return a.request.request.id===null||a.request.request.id===void 0}):r.request.id===null||r.request.id===void 0},s.uri=e,s.credentials=n&&n.credentials,s.headers=t.setupHeaders(n&&n.headers),s.injectedFetcher=n?.fetcher,s}return t.prototype.connect=function(){return Promise.resolve()},t.prototype.sendData=function(e,n){return n===void 0&&(n=null),gt(this,void 0,void 0,function(){var s,r,a,c,h,o,p,u,p;return Rt(this,function(D){switch(D.label){case 0:s=this.transportRequestManager.addRequest(e,n),r=ie.getNotifications(e),a=ie.getBatchRequests(e),c=this.injectedFetcher||wt.default,D.label=1;case 1:return D.trys.push([1,4,,5]),[4,c(this.uri,{method:"POST",headers:this.headers,body:JSON.stringify(this.parseData(e)),credentials:this.credentials})];case 2:return h=D.sent(),this.transportRequestManager.settlePendingRequest(r),this.onlyNotifications(e)?[2,Promise.resolve()]:[4,h.text()];case 3:return o=D.sent(),p=this.transportRequestManager.resolveResponse(o),p?(this.transportRequestManager.settlePendingRequest(a,p),[2,Promise.reject(p)]):[3,5];case 4:return u=D.sent(),p=new Oe.JSONRPCError(u.message,Oe.ERR_UNKNOWN,u),this.transportRequestManager.settlePendingRequest(r,p),this.transportRequestManager.settlePendingRequest(ie.getBatchRequests(e),p),[2,Promise.reject(p)];case 5:return [2,s]}})})},t.prototype.close=function(){},t.setupHeaders=function(e){var n=new Headers(e);return n.set("Content-Type","application/json"),n},t}(qt.Transport);q.HTTPTransport=Ne;q.default=Ne;});var Me={};d(Me,{default:()=>_t});var U,_t,xe=b$1(()=>{j$1();h();U=null;typeof WebSocket<"u"?U=WebSocket:typeof MozWebSocket<"u"?U=MozWebSocket:typeof globalThis<"u"?U=globalThis.WebSocket||globalThis.MozWebSocket:typeof window<"u"?U=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(U=self.WebSocket||self.MozWebSocket);_t=U;});var Je=c(P=>{j$1();h();var Pt=P&&P.__extends||function(){var i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s;}||function(n,s){for(var r in s)s.hasOwnProperty(r)&&(n[r]=s[r]);},i(t,e)};return function(t,e){i(t,e);function n(){this.constructor=t;}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n);}}(),St=P&&P.__awaiter||function(i,t,e,n){function s(r){return r instanceof e?r:new e(function(a){a(r);})}return new(e||(e=Promise))(function(r,a){function c(u){try{o(n.next(u));}catch(p){a(p);}}function h(u){try{o(n.throw(u));}catch(p){a(p);}}function o(u){u.done?r(u.value):s(u.value).then(c,h);}o((n=n.apply(i,t||[])).next());})},Et=P&&P.__generator||function(i,t){var e={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},n,s,r,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(o){return function(u){return h([o,u])}}function h(o){if(n)throw new TypeError("Generator is already executing.");for(;e;)try{if(n=1,s&&(r=o[0]&2?s.return:o[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,o[1])).done)return r;switch(s=0,r&&(o=[o[0]&2,r.value]),o[0]){case 0:case 1:r=o;break;case 4:return e.label++,{value:o[1],done:!1};case 5:e.label++,s=o[1],o=[0];continue;case 7:o=e.ops.pop(),e.trys.pop();continue;default:if(r=e.trys,!(r=r.length>0&&r[r.length-1])&&(o[0]===6||o[0]===2)){e=0;continue}if(o[0]===3&&(!r||o[1]>r[0]&&o[1]<r[3])){e.label=o[1];break}if(o[0]===6&&e.label<r[1]){e.label=r[1],r=o;break}if(r&&e.label<r[2]){e.label=r[2],e.ops.push(o);break}r[2]&&e.ops.pop(),e.trys.pop();continue}o=t.call(i,e);}catch(u){o=[6,u],s=0;}finally{n=r=0;}if(o[0]&5)throw o[1];return {value:o[0]?o[1]:void 0,done:!0}}},Ct=P&&P.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(P,"__esModule",{value:!0});var Tt=Ct((xe(),f(Me))),Ot=j(),De=B(),ke=k(),Nt=function(i){Pt(t,i);function t(e){var n=i.call(this)||this;return n.uri=e,n.connection=new Tt.default(e),n}return t.prototype.connect=function(){var e=this;return new Promise(function(n,s){var r=function(){e.connection.removeEventListener("open",r),n();};e.connection.addEventListener("open",r),e.connection.addEventListener("message",function(a){var c=a.data;e.transportRequestManager.resolveResponse(c);});})},t.prototype.sendData=function(e,n){return n===void 0&&(n=5e3),St(this,void 0,void 0,function(){var s,r,a;return Et(this,function(c){s=this.transportRequestManager.addRequest(e,n),r=De.getNotifications(e);try{this.connection.send(JSON.stringify(this.parseData(e))),this.transportRequestManager.settlePendingRequest(r);}catch(h){a=new ke.JSONRPCError(h.message,ke.ERR_UNKNOWN,h),this.transportRequestManager.settlePendingRequest(r,a),this.transportRequestManager.settlePendingRequest(De.getBatchRequests(e),a),s=Promise.reject(a);}return [2,s]})})},t.prototype.close=function(){this.connection.close();},t}(Ot.Transport);P.default=Nt;});var Ae=c(C=>{j$1();h();var It=C&&C.__extends||function(){var i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s;}||function(n,s){for(var r in s)s.hasOwnProperty(r)&&(n[r]=s[r]);},i(t,e)};return function(t,e){i(t,e);function n(){this.constructor=t;}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n);}}(),je=C&&C.__awaiter||function(i,t,e,n){function s(r){return r instanceof e?r:new e(function(a){a(r);})}return new(e||(e=Promise))(function(r,a){function c(u){try{o(n.next(u));}catch(p){a(p);}}function h(u){try{o(n.throw(u));}catch(p){a(p);}}function o(u){u.done?r(u.value):s(u.value).then(c,h);}o((n=n.apply(i,t||[])).next());})},Be=C&&C.__generator||function(i,t){var e={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},n,s,r,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(o){return function(u){return h([o,u])}}function h(o){if(n)throw new TypeError("Generator is already executing.");for(;e;)try{if(n=1,s&&(r=o[0]&2?s.return:o[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,o[1])).done)return r;switch(s=0,r&&(o=[o[0]&2,r.value]),o[0]){case 0:case 1:r=o;break;case 4:return e.label++,{value:o[1],done:!1};case 5:e.label++,s=o[1],o=[0];continue;case 7:o=e.ops.pop(),e.trys.pop();continue;default:if(r=e.trys,!(r=r.length>0&&r[r.length-1])&&(o[0]===6||o[0]===2)){e=0;continue}if(o[0]===3&&(!r||o[1]>r[0]&&o[1]<r[3])){e.label=o[1];break}if(o[0]===6&&e.label<r[1]){e.label=r[1],r=o;break}if(r&&e.label<r[2]){e.label=r[2],e.ops.push(o);break}r[2]&&e.ops.pop(),e.trys.pop();continue}o=t.call(i,e);}catch(u){o=[6,u],s=0;}finally{n=r=0;}if(o[0]&5)throw o[1];return {value:o[0]?o[1]:void 0,done:!0}}};Object.defineProperty(C,"__esModule",{value:!0});var Mt=j(),xt=B(),Dt=function(i){var t=400,e=window.screen.height,n=0,s=0;return window.open(i,"inspector:popup","left="+n+",top="+s+",width="+t+",height="+e+",resizable,scrollbars=yes,status=1")},kt=function(i){It(t,i);function t(e){var n=i.call(this)||this;return n.messageHandler=function(s){n.transportRequestManager.resolveResponse(JSON.stringify(s.data));},n.uri=e,n.postMessageID="post-message-transport-"+Math.random(),n}return t.prototype.createWindow=function(e){return new Promise(function(n,s){var r;r=Dt(e),setTimeout(function(){n(r);},3e3);})},t.prototype.connect=function(){var e=this,n=/^(http|https):\/\/.*$/;return new Promise(function(s,r){return je(e,void 0,void 0,function(){var a;return Be(this,function(c){switch(c.label){case 0:return n.test(this.uri)||r(new Error("Bad URI")),a=this,[4,this.createWindow(this.uri)];case 1:return a.frame=c.sent(),window.addEventListener("message",this.messageHandler),s(),[2]}})})})},t.prototype.sendData=function(e,n){return je(this,void 0,void 0,function(){var s,r;return Be(this,function(a){return s=this.transportRequestManager.addRequest(e,null),r=xt.getNotifications(e),this.frame&&(this.frame.postMessage(e.request,this.uri),this.transportRequestManager.settlePendingRequest(r)),[2,s]})})},t.prototype.close=function(){this.frame&&(window.removeEventListener("message",this.messageHandler),this.frame.close());},t}(Mt.Transport);C.default=kt;});var Le=c(T=>{j$1();h();var Jt=T&&T.__extends||function(){var i=function(t,e){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,s){n.__proto__=s;}||function(n,s){for(var r in s)s.hasOwnProperty(r)&&(n[r]=s[r]);},i(t,e)};return function(t,e){i(t,e);function n(){this.constructor=t;}t.prototype=e===null?Object.create(e):(n.prototype=e.prototype,new n);}}(),Ue=T&&T.__awaiter||function(i,t,e,n){function s(r){return r instanceof e?r:new e(function(a){a(r);})}return new(e||(e=Promise))(function(r,a){function c(u){try{o(n.next(u));}catch(p){a(p);}}function h(u){try{o(n.throw(u));}catch(p){a(p);}}function o(u){u.done?r(u.value):s(u.value).then(c,h);}o((n=n.apply(i,t||[])).next());})},We=T&&T.__generator||function(i,t){var e={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},n,s,r,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(o){return function(u){return h([o,u])}}function h(o){if(n)throw new TypeError("Generator is already executing.");for(;e;)try{if(n=1,s&&(r=o[0]&2?s.return:o[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,o[1])).done)return r;switch(s=0,r&&(o=[o[0]&2,r.value]),o[0]){case 0:case 1:r=o;break;case 4:return e.label++,{value:o[1],done:!1};case 5:e.label++,s=o[1],o=[0];continue;case 7:o=e.ops.pop(),e.trys.pop();continue;default:if(r=e.trys,!(r=r.length>0&&r[r.length-1])&&(o[0]===6||o[0]===2)){e=0;continue}if(o[0]===3&&(!r||o[1]>r[0]&&o[1]<r[3])){e.label=o[1];break}if(o[0]===6&&e.label<r[1]){e.label=r[1],r=o;break}if(r&&e.label<r[2]){e.label=r[2],e.ops.push(o);break}r[2]&&e.ops.pop(),e.trys.pop();continue}o=t.call(i,e);}catch(u){o=[6,u],s=0;}finally{n=r=0;}if(o[0]&5)throw o[1];return {value:o[0]?o[1]:void 0,done:!0}}};Object.defineProperty(T,"__esModule",{value:!0});var jt=j(),Bt=B(),At=function(i){Jt(t,i);function t(e){var n=i.call(this)||this;return n.messageHandler=function(s){n.transportRequestManager.resolveResponse(JSON.stringify(s.data));},n.uri=e,n.postMessageID="post-message-transport-"+Math.random(),n}return t.prototype.createWindow=function(e){var n=this;return new Promise(function(s,r){var a,c=document.createElement("iframe");c.setAttribute("id",n.postMessageID),c.setAttribute("width","0px"),c.setAttribute("height","0px"),c.setAttribute("style","visiblity:hidden;border:none;outline:none;"),c.addEventListener("load",function(){s(a);}),c.setAttribute("src",e),window.document.body.appendChild(c),a=c.contentWindow;})},t.prototype.connect=function(){var e=this,n=/^(http|https):\/\/.*$/;return new Promise(function(s,r){return Ue(e,void 0,void 0,function(){var a;return We(this,function(c){switch(c.label){case 0:return n.test(this.uri)||r(new Error("Bad URI")),a=this,[4,this.createWindow(this.uri)];case 1:return a.frame=c.sent(),window.addEventListener("message",this.messageHandler),s(),[2]}})})})},t.prototype.sendData=function(e,n){return Ue(this,void 0,void 0,function(){var s,r;return We(this,function(a){return s=this.transportRequestManager.addRequest(e,null),r=Bt.getNotifications(e),this.frame&&(this.frame.postMessage(e.request,"*"),this.transportRequestManager.settlePendingRequest(r)),[2,s]})})},t.prototype.close=function(){var e=document.getElementById(this.postMessageID);e?.remove(),window.removeEventListener("message",this.messageHandler);},t}(jt.Transport);T.default=At;});var ze=c(I=>{j$1();h();var Fe=I&&I.__awaiter||function(i,t,e,n){function s(r){return r instanceof e?r:new e(function(a){a(r);})}return new(e||(e=Promise))(function(r,a){function c(u){try{o(n.next(u));}catch(p){a(p);}}function h(u){try{o(n.throw(u));}catch(p){a(p);}}function o(u){u.done?r(u.value):s(u.value).then(c,h);}o((n=n.apply(i,t||[])).next());})},He=I&&I.__generator||function(i,t){var e={label:0,sent:function(){if(r[0]&1)throw r[1];return r[1]},trys:[],ops:[]},n,s,r,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(o){return function(u){return h([o,u])}}function h(o){if(n)throw new TypeError("Generator is already executing.");for(;e;)try{if(n=1,s&&(r=o[0]&2?s.return:o[0]?s.throw||((r=s.return)&&r.call(s),0):s.next)&&!(r=r.call(s,o[1])).done)return r;switch(s=0,r&&(o=[o[0]&2,r.value]),o[0]){case 0:case 1:r=o;break;case 4:return e.label++,{value:o[1],done:!1};case 5:e.label++,s=o[1],o=[0];continue;case 7:o=e.ops.pop(),e.trys.pop();continue;default:if(r=e.trys,!(r=r.length>0&&r[r.length-1])&&(o[0]===6||o[0]===2)){e=0;continue}if(o[0]===3&&(!r||o[1]>r[0]&&o[1]<r[3])){e.label=o[1];break}if(o[0]===6&&e.label<r[1]){e.label=r[1],r=o;break}if(r&&e.label<r[2]){e.label=r[2],e.ops.push(o);break}r[2]&&e.ops.pop(),e.trys.pop();continue}o=t.call(i,e);}catch(u){o=[6,u],s=0;}finally{n=r=0;}if(o[0]&5)throw o[1];return {value:o[0]?o[1]:void 0,done:!0}}};Object.defineProperty(I,"__esModule",{value:!0});var Ut=function(){function i(t){this.requestManager=t;}return i.prototype.startBatch=function(){return this.requestManager.startBatch()},i.prototype.stopBatch=function(){return this.requestManager.stopBatch()},i.prototype.request=function(t,e){return Fe(this,void 0,void 0,function(){return He(this,function(n){switch(n.label){case 0:return this.requestManager.connectPromise?[4,this.requestManager.connectPromise]:[3,2];case 1:n.sent(),n.label=2;case 2:return [2,this.requestManager.request(t,!1,e)]}})})},i.prototype.notify=function(t){return Fe(this,void 0,void 0,function(){return He(this,function(e){switch(e.label){case 0:return this.requestManager.connectPromise?[4,this.requestManager.connectPromise]:[3,2];case 1:e.sent(),e.label=2;case 2:return [2,this.requestManager.request(t,!0,null)]}})})},i.prototype.onNotification=function(t){this.requestManager.requestChannel.addListener("notification",t);},i.prototype.onError=function(t){this.requestManager.requestChannel.addListener("error",t);},i.prototype.close=function(){this.requestManager.close();},i}();I.default=Ut;});var Ke=c(y=>{j$1();h();var M=y&&y.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(y,"__esModule",{value:!0});y.PostMessageIframeTransport=y.PostMessageWindowTransport=y.JSONRPCError=y.WebSocketTransport=y.EventEmitterTransport=y.HTTPTransport=y.RequestManager=y.Client=void 0;var Wt=M(ye());y.RequestManager=Wt.default;var Lt=M(Re());y.EventEmitterTransport=Lt.default;var Ft=M(Ie());y.HTTPTransport=Ft.default;var Ht=M(Je());y.WebSocketTransport=Ht.default;var zt=M(Ae());y.PostMessageWindowTransport=zt.default;var Gt=M(Le());y.PostMessageIframeTransport=Gt.default;var Kt=k();Object.defineProperty(y,"JSONRPCError",{enumerable:!0,get:function(){return Kt.JSONRPCError}});var Ge=M(ze());y.Client=Ge.default;y.default=Ge.default;});j$1();h();j$1();h();j$1();h();var L=e(Ke()),Q=e(a()),se=1e4;Object.fromEntries(Object.entries(Q.CompletionItemKind).map(([i,t])=>[t,i]));var ae=i=>i.reduce((t,e)=>e,"");Facet.define({combine:ae});Facet.define({combine:ae});Facet.define({combine:ae});var $=class{constructor(t){this.rootUri=t.rootUri,this.workspaceFolders=t.workspaceFolders,this.autoClose=t.autoClose,this.plugins=[],this.transport=t.transport,this.requestManager=new L.RequestManager([this.transport]),this.client=new L.Client(this.requestManager),this.client.onNotification(n=>{this.processNotification(n);});let e=this.transport;e&&e.connection&&e.connection.addEventListener("message",n=>{let s=JSON.parse(n.data);s.method&&s.id&&e.connection.send(JSON.stringify({jsonrpc:"2.0",id:s.id,result:null}));}),this.initializePromise=this.initialize();}async initialize(){let{capabilities:t}=await this.request("initialize",{capabilities:{textDocument:{hover:{dynamicRegistration:!0,contentFormat:["plaintext","markdown"]},moniker:{},synchronization:{dynamicRegistration:!0,willSave:!1,didSave:!1,willSaveWaitUntil:!1},completion:{dynamicRegistration:!0,completionItem:{snippetSupport:!1,commitCharactersSupport:!0,documentationFormat:["plaintext","markdown"],deprecatedSupport:!1,preselectSupport:!1},contextSupport:!1},signatureHelp:{dynamicRegistration:!0,signatureInformation:{documentationFormat:["plaintext","markdown"]}},declaration:{dynamicRegistration:!0,linkSupport:!0},definition:{dynamicRegistration:!0,linkSupport:!0},typeDefinition:{dynamicRegistration:!0,linkSupport:!0},implementation:{dynamicRegistration:!0,linkSupport:!0}},workspace:{didChangeConfiguration:{dynamicRegistration:!0}}},initializationOptions:null,processId:null,rootUri:this.rootUri,workspaceFolders:this.workspaceFolders},se*3);this.capabilities=t,this.notify("initialized",{}),this.ready=!0;}close(){this.client.close();}textDocumentDidOpen(t){return this.notify("textDocument/didOpen",t)}textDocumentDidChange(t){return this.notify("textDocument/didChange",t)}async textDocumentHover(t){return await this.request("textDocument/hover",t,se)}async textDocumentCompletion(t){return await this.request("textDocument/completion",t,se)}attachPlugin(t){this.plugins.push(t);}detachPlugin(t){let e=this.plugins.indexOf(t);e!==-1&&(this.plugins.splice(e,1),this.autoClose&&this.close());}request(t,e,n){return this.client.request({method:t,params:e},n)}notify(t,e){return this.client.notify({method:t,params:e})}processNotification(t){for(let e of this.plugins)e.processNotification(t);}};j$1();h();j$1();h();o();j$1();h();j$1();h();o();j$1();h();var x=class extends Error{constructor(e,n,s){super(e);this.message=e,this.code=n,this.data=s,Object.setPrototypeOf(this,new.target.prototype);}},ue=i=>{if(i.error){let{message:t,code:e,data:n}=i.error;return new x(t,e,n)}return new x("Unknown error",7979,i)};var V=class{constructor(){this.pendingRequest={},this.pendingBatchRequest={},this.transportEventChannel=new m$1;}addRequest(t,e){return this.transportEventChannel.emit("pending",t),t instanceof Array?(this.addBatchReq(t,e),Promise.resolve()):this.addReq(t.internalID,e)}settlePendingRequest(t,e){t.forEach(n=>{let s=this.pendingRequest[n.internalID];if(delete this.pendingBatchRequest[n.internalID],s!==void 0){if(e){s.reject(e);return}s.resolve(),(n.request.id===null||n.request.id===void 0)&&delete this.pendingRequest[n.internalID];}});}isPendingRequest(t){return this.pendingRequest.hasOwnProperty(t)}resolveResponse(t,e=!0){let n=t;try{return n=JSON.parse(t),this.checkJSONRPC(n)===!1?void 0:n instanceof Array?this.resolveBatch(n,e):this.resolveRes(n,e)}catch{let r=new x("Bad response format",7979,t);return e&&this.transportEventChannel.emit("error",r),r}}addBatchReq(t,e){return t.forEach(n=>{let{resolve:s,reject:r}=n,{internalID:a}=n.request;this.pendingBatchRequest[a]=!0,this.pendingRequest[a]={resolve:s,reject:r};}),Promise.resolve()}addReq(t,e){return new Promise((n,s)=>{e!==null&&e&&this.setRequestTimeout(t,e,s),this.pendingRequest[t]={resolve:n,reject:s};})}checkJSONRPC(t){let e=[t];return t instanceof Array&&(e=t),e.every(n=>n.result!==void 0||n.error!==void 0||n.method!==void 0)}processResult(t,e){if(t.error){let n=ue(t);e.reject(n);return}e.resolve(t.result);}resolveBatch(t,e){let s=t.map(r=>this.resolveRes(r,e)).filter(r=>r);if(s.length>0)return s[0]}resolveRes(t,e){let{id:n,error:s}=t,r=this.pendingRequest[n];if(r){delete this.pendingRequest[n],this.processResult(t,r),this.transportEventChannel.emit("response",t);return}if(n===void 0&&s===void 0){this.transportEventChannel.emit("notification",t);return}let a;return s&&(a=ue(t)),e&&s&&a&&this.transportEventChannel.emit("error",a),a}setRequestTimeout(t,e,n){setTimeout(()=>{delete this.pendingRequest[t],n(new x(`Request timeout request took longer than ${e} ms to resolve`,7777));},e);}};var X=class{constructor(){this.transportRequestManager=new V,this.transportRequestManager.transportEventChannel.on("error",()=>{});}subscribe(t,e){this.transportRequestManager.transportEventChannel.addListener(t,e);}unsubscribe(t,e){if(!t)return this.transportRequestManager.transportEventChannel.removeAllListeners();t&&e&&this.transportRequestManager.transportEventChannel.removeListener(t,e);}parseData(t){return t instanceof Array?t.map(e=>e.request.request):t.request}};j$1();h();var $e=i=>i.request.id===void 0||i.request.id===null;var Qe=i=>i instanceof Array?i.filter(t=>$e(t.request)).map(t=>t.request):$e(i)?[i]:[];var F=class extends X{constructor(e){super();this.messageHandler=e=>{console.debug("<-",e.data),this.transportRequestManager.resolveResponse(JSON.stringify(e.data));};this.worker=e,this.postMessageID=`post-message-transport-${Math.random()}`;}connect(){return new Promise(async(e,n)=>{this.worker.addEventListener("message",this.messageHandler),e();})}async sendData(e,n=5e3){console.debug("->",e);let s=this.transportRequestManager.addRequest(e,null),r=Qe(e);return this.worker&&(this.worker.postMessage(e.request),this.transportRequestManager.settlePendingRequest(r)),s}close(){this.worker?.terminate();}};var ce=class extends F{constructor(e,n){let s;switch(typeof e){case"string":s=new Worker(e);break;default:{if(e instanceof Worker){s=e;break}if(e instanceof URL){s=new Worker(e);break}throw new Error(`Invalid worker type. Expected string, URL, or Worker. Received ${typeof e}`)}}super(s);this.options=n;this.internalMessageId=0;this.rpcQueue=new Map;this.client=()=>(this.langClient||(this.langClient=new $({transport:this,...this.options})),this.langClient);this.onMessage=this.onMessage.bind(this),this.worker.addEventListener("message",this.onMessage),this.worker.onerror=r=>{console.error(r);},this.worker.onmessageerror=r=>{console.error(r);};}dispose(){this.worker.removeEventListener("message",this.onMessage),this.worker.terminate(),this.rpcQueue.clear(),this.langClient.close();}sendNotification(e,n){this.langClient.notify(e,n);}addFiles(e,n){if(typeof e=="object")return this.sendAddFiles(e);if(typeof e=="string"&&typeof n=="string")return this.sendAddFiles({[e]:n});throw new Error("Invalid arguments")}fetchTypes(e){return this.sendFetchTypes(e)}setup(e,n){if(typeof e=="object")return this.sendSetup(e);if(typeof e=="string"&&typeof n=="string")return this.sendSetup({[e]:n});throw new Error("Invalid arguments")}deleteFile(e){return this.sendDeleteFile(e)}sendDeleteFile(e){return new Promise((n,s)=>{let r=this.internalMessageId++;this.rpcQueue.set(r,n),this.worker.postMessage({id:r,method:"@@delete-file",params:{fileName:e}});})}onMessage(e){let n=e.data;if(!(n&&typeof n=="object"&&"jsonrpc"in n)&&n&&typeof n=="object"&&"method"in n&&"complete"in n){let s=n.method;switch(s){case"@@setup":case"@@add-files":case"@@fetch-types":this.rpcQueue.get(n.id)?.(n.complete),this.rpcQueue.delete(n.id);return;default:throw new Error(`Unknown RPC method ${s}`)}}}sendAddFiles(e){return new Promise((s,r)=>{let a=this.internalMessageId++;this.rpcQueue.set(a,s),this.worker.postMessage({params:e,id:a,method:"@@add-files"});})}sendFetchTypes(e){return new Promise((n,s)=>{let r=this.internalMessageId++;this.rpcQueue.set(r,n),this.worker.postMessage({id:r,method:"@@fetch-types",params:e});})}async sendSetup(e){return new Promise((s,r)=>{let a=this.internalMessageId++;this.rpcQueue.set(a,s),this.worker.postMessage({params:e,id:a,method:"@@setup"});}).then(s=>this.client())}};

export { ce as WorkerRPC };
